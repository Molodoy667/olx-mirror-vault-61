import{r as b,v as E,j as e,k as _,B as p,s as x,t as w}from"./index-KbJkRX07.js";import{u as A}from"./useQuery-DYBXd3SC.js";import{u as T}from"./useMutation-BJki3aSv.js";import{A as F,a as L}from"./AdminHeader-BFn_Zmrn.js";import{B as n}from"./badge-DpjjU75J.js";import{D as P,a as Q,b as R,c as H,d as K}from"./dialog-C3rICmIe.js";import{T as U}from"./textarea-dp5bmWKD.js";import{L as t}from"./label-CwWGJCIM.js";import{B as I}from"./settings-DWrH-Tg4.js";import{E as M}from"./eye-jg7wg44x.js";import{C as y}from"./circle-x-CEBvVcIA.js";import{C}from"./circle-check-big-HnBDMycv.js";import{C as O}from"./clock-DUppK43j.js";import{f as V,u as X}from"./uk-Drv84rxe.js";import"./Combination-CN-dILO0.js";import"./index-CAsdkEwS.js";import"./users-CUWo_zW8.js";import"./dollar-sign--DFDUvgJ.js";function oe(){const[a,j]=b.useState(null),[u,h]=b.useState(""),S=E(),{data:r,isLoading:B}=A({queryKey:["business-verification-requests"],queryFn:async()=>{const{data:s,error:i}=await x.from("business_verification_requests").select(`
          *,
          profiles:user_id (
            full_name,
            username
          )
        `).order("created_at",{ascending:!1});if(i)throw i;return s}}),d=T({mutationFn:async({id:s,status:i,notes:l,shouldUpdateProfile:c=!1})=>{var v;const{data:o}=await x.auth.getUser(),{error:m}=await x.from("business_verification_requests").update({status:i,admin_notes:l,reviewed_by:(v=o.user)==null?void 0:v.id,reviewed_at:new Date().toISOString()}).eq("id",s);if(m)throw m;if(i==="approved"&&c&&a){const{error:N}=await x.from("profiles").update({account_type:"business",is_verified:!0,verification_badge:"business",business_name:a.business_name,business_description:a.description}).eq("id",a.user_id);if(N)throw N}},onSuccess:(s,{status:i})=>{S.invalidateQueries({queryKey:["business-verification-requests"]}),w({title:`Заявку ${i==="approved"?"схвалено":"відхилено"}`,description:i==="approved"?"Користувач отримав бізнес-статус":void 0}),j(null),h("")},onError:()=>{w({title:"Помилка",description:"Не вдалося обробити заявку",variant:"destructive"})}}),D=()=>{a&&d.mutate({id:a.id,status:"approved",notes:u,shouldUpdateProfile:!0})},k=()=>{a&&d.mutate({id:a.id,status:"rejected",notes:u})},f=s=>{switch(s){case"pending":return e.jsxs(n,{variant:"secondary",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Очікує"]});case"approved":return e.jsxs(n,{variant:"default",className:"bg-green-600",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Схвалено"]});case"rejected":return e.jsxs(n,{variant:"destructive",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Відхилено"]});default:return e.jsx(n,{variant:"outline",children:s})}},g=(r==null?void 0:r.filter(s=>s.status==="pending").length)||0;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(F,{}),e.jsxs("div",{className:"flex",children:[e.jsx(L,{}),e.jsxs("main",{className:"flex-1 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Верифікація бізнес-акаунтів"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Модерація заявок на отримання бізнес-статусу"}),g>0&&e.jsxs(n,{variant:"secondary",className:"mt-2",children:[g," заявок очікує розгляду"]})]})}),e.jsx("div",{className:"space-y-4",children:B?e.jsx("div",{className:"text-center py-8",children:"Завантаження..."}):(r==null?void 0:r.length)===0?e.jsxs(_,{className:"p-8 text-center",children:[e.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Немає заявок"}),e.jsx("p",{className:"text-muted-foreground",children:"Поки що немає заявок на верифікацію бізнес-акаунтів"})]}):r==null?void 0:r.map(s=>{var i,l,c,o;return e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.business_name}),f(s.status)]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Користувач:"}),e.jsx("span",{className:"ml-2",children:((i=s.profiles)==null?void 0:i.full_name)||((l=s.profiles)==null?void 0:l.username)||"Невідомо"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Тип бізнесу:"}),e.jsx("span",{className:"ml-2",children:s.business_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Податковий номер:"}),e.jsx("span",{className:"ml-2",children:s.tax_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Подано:"}),e.jsx("span",{className:"ml-2",children:V(new Date(s.created_at),{addSuffix:!0,locale:X})})]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground",children:s.description}),s.admin_notes&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Примітки адміністратора:"}),e.jsx("p",{className:"text-sm mt-1",children:s.admin_notes})]})]}),e.jsxs(P,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(p,{variant:"outline",onClick:()=>{j(s),h(s.admin_notes||"")},children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Переглянути"]})}),e.jsxs(R,{className:"max-w-2xl",children:[e.jsx(H,{children:e.jsxs(K,{children:["Деталі заявки - ",a==null?void 0:a.business_name]})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground",children:"Користувач"}),e.jsx("p",{children:((c=a.profiles)==null?void 0:c.full_name)||((o=a.profiles)==null?void 0:o.username)||"Невідомо"})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground",children:"Статус"}),e.jsx("div",{className:"mt-1",children:f(a.status)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground",children:"Назва бізнесу"}),e.jsx("p",{children:a.business_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground",children:"Тип бізнесу"}),e.jsx("p",{children:a.business_type})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground",children:"Податковий номер"}),e.jsx("p",{children:a.tax_id})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground",children:"Веб-сайт"}),e.jsx("p",{children:a.website||"Не вказано"})]})]}),a.description&&e.jsxs("div",{children:[e.jsx(t,{className:"text-muted-foreground",children:"Опис"}),e.jsx("p",{className:"mt-1",children:a.description})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"admin_notes",children:"Примітки адміністратора"}),e.jsx(U,{id:"admin_notes",value:u,onChange:m=>h(m.target.value),placeholder:"Додайте коментар до рішення...",rows:3,className:"mt-1"})]}),a.status==="pending"&&e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(p,{onClick:k,variant:"outline",className:"flex-1 text-red-600 hover:text-red-700",disabled:d.isPending,children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Відхилити"]}),e.jsxs(p,{onClick:D,className:"flex-1 bg-green-600 hover:bg-green-700",disabled:d.isPending,children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Схвалити"]})]})]})]})]})]})},s.id)})})]})]})]})}export{oe as default};
