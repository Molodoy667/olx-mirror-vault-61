import{u as _,r as t,s as u,t as l,j as e,B as v}from"./index-KbJkRX07.js";import{u as q}from"./useAdmin-wN6CKAL8.js";import{A as B,a as D}from"./AdminHeader-BFn_Zmrn.js";import{I as H}from"./input-BfmWFPkP.js";import{S as N,d as b,e as w,f as S,g as a}from"./select-CxSQralT.js";import{T as V,a as z,b as y,c,d as F,e as n}from"./table--IrP7ivg.js";import{S as P}from"./search-B1u6Ento.js";import{U as $}from"./user-Dt39FPRe.js";import{S as T}from"./Combination-CN-dILO0.js";import{S as G}from"./square-pen-q68WjATM.js";import{T as J}from"./trash-2-CCvey3Fk.js";import"./index-CAsdkEwS.js";import"./users-CUWo_zW8.js";import"./dollar-sign--DFDUvgJ.js";import"./settings-DWrH-Tg4.js";import"./index-D5jjwgwZ.js";function ne(){const o=_(),{isAdmin:m,loading:x}=q(),[f,C]=t.useState([]),[d,U]=t.useState(""),[h,k]=t.useState("all"),[A,L]=t.useState(!0);t.useEffect(()=>{!x&&!m&&o("/")},[m,x,o]),t.useEffect(()=>{j()},[]);const j=async()=>{try{const{data:s,error:r}=await u.from("profiles").select("*").order("created_at",{ascending:!1});if(r)throw r;C(s||[])}catch(s){console.error("Error loading users:",s),l({title:"Помилка",description:"Не вдалося завантажити користувачів",variant:"destructive"})}finally{L(!1)}},E=async(s,r)=>{try{const{error:i}=await u.from("profiles").update({role:r}).eq("id",s);if(i)throw i;l({title:"Успішно",description:"Роль користувача оновлено"}),j()}catch{l({title:"Помилка",description:"Не вдалося оновити роль",variant:"destructive"})}},R=async s=>{if(confirm("Ви впевнені, що хочете видалити цього користувача?"))try{const{error:r}=await u.from("profiles").delete().eq("id",s);if(r)throw r;l({title:"Успішно",description:"Користувача видалено"}),j()}catch{l({title:"Помилка",description:"Не вдалося видалити користувача",variant:"destructive"})}},I=f.filter(s=>{var p,g;const r=(((p=s.full_name)==null?void 0:p.toLowerCase())||"").includes(d.toLowerCase())||(((g=s.username)==null?void 0:g.toLowerCase())||"").includes(d.toLowerCase())||s.id.includes(d),i=h==="all"||s.role===h;return r&&i});return x||A?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):m?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(D,{})}),e.jsxs("main",{className:"flex-1 p-4 md:p-6 lg:p-8 overflow-x-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:"Управління користувачами"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Всього користувачів: ",f.length]})]}),e.jsx("div",{className:"bg-card rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Пошук користувачів...",value:d,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsxs(N,{value:h,onValueChange:k,children:[e.jsx(b,{children:e.jsx(w,{placeholder:"Фільтр за роллю"})}),e.jsxs(S,{children:[e.jsx(a,{value:"all",children:"Всі ролі"}),e.jsx(a,{value:"user",children:"Користувач"}),e.jsx(a,{value:"moderator",children:"Модератор"}),e.jsx(a,{value:"admin",children:"Адміністратор"})]})]})]})}),e.jsx("div",{className:"bg-card rounded-lg overflow-hidden",children:e.jsxs(V,{children:[e.jsx(z,{children:e.jsxs(y,{children:[e.jsx(c,{children:"Користувач"}),e.jsx(c,{children:"Локація"}),e.jsx(c,{children:"Роль"}),e.jsx(c,{children:"Дата реєстрації"}),e.jsx(c,{className:"text-right",children:"Дії"})]})}),e.jsx(F,{children:I.map(s=>e.jsxs(y,{children:[e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.full_name||s.username||"Без імені"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",s.id.slice(0,8),"..."]})]})}),e.jsx(n,{children:s.location||"—"}),e.jsx(n,{children:e.jsxs(N,{value:s.role,onValueChange:r=>E(s.id,r),children:[e.jsx(b,{className:"w-32",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(a,{value:"user",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Користувач"]})}),e.jsx(a,{value:"moderator",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-blue-500"}),"Модератор"]})}),e.jsx(a,{value:"admin",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-red-500"}),"Адміністратор"]})})]})]})}),e.jsx(n,{children:new Date(s.created_at).toLocaleDateString("uk-UA")}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(v,{variant:"outline",size:"icon",onClick:()=>o(`/profile/${s.id}`),children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(v,{variant:"destructive",size:"icon",onClick:()=>R(s.id),children:e.jsx(J,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]})]}):null}export{ne as default};
