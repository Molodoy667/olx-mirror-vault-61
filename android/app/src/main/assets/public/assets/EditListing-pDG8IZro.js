import{w as D,u as F,h as q,r as m,j as e,B as f,X as E,s as y,t as u}from"./index-KbJkRX07.js";import{a as I}from"./useCategories-C6twurrF.js";import{H,b as k}from"./Footer-CG381HwE.js";import{I as b}from"./input-BfmWFPkP.js";import{T as R}from"./textarea-dp5bmWKD.js";import{S as N,d as S,e as w,f as C,g as p}from"./select-CxSQralT.js";import{L as l}from"./label-CwWGJCIM.js";import{K as P}from"./KatottgCityAutocomplete-CQmrrgYI.js";import{A as T}from"./arrow-left-8vQ30E0Z.js";import{U as V}from"./upload-C80PTcyb.js";import{D as B}from"./dollar-sign--DFDUvgJ.js";import"./useQuery-DYBXd3SC.js";import"./useAdmin-wN6CKAL8.js";import"./Combination-CN-dILO0.js";import"./badge-DpjjU75J.js";import"./index-D5jjwgwZ.js";import"./index-ohYBQjSJ.js";import"./globe-BvyP_gKp.js";import"./uk-Drv84rxe.js";import"./star-B840Te7u.js";import"./eye-jg7wg44x.js";import"./heart-BstkNJZ-.js";import"./avatar-CGybcn-y.js";import"./user-Dt39FPRe.js";import"./search-B1u6Ento.js";import"./plus-D5zmitre.js";import"./index-CAsdkEwS.js";import"./dialog-C3rICmIe.js";import"./map-pin-0eGOnbmD.js";function je(){const{id:h}=D(),o=F(),{user:n}=q(),{data:x}=I(),[g,v]=m.useState(!1),[c,j]=m.useState([]),[t,a]=m.useState({title:"",description:"",category_id:"",price:"",currency:"UAH",location:""});m.useEffect(()=>{if(!n){o("/auth");return}(async()=>{var i;const{data:s,error:d}=await y.from("listings").select("*").eq("id",h).eq("user_id",n.id).single();if(d||!s){u({title:"Помилка",description:"Не вдалося завантажити оголошення",variant:"destructive"}),o("/my-listings");return}a({title:s.title||"",description:s.description||"",category_id:s.category_id||"",price:((i=s.price)==null?void 0:i.toString())||"",currency:s.currency||"UAH",location:s.location||""}),j(s.images||[])})()},[h,n,o]);const _=r=>{const s=r.target.files;s&&Array.from(s).forEach(d=>{const i=new FileReader;i.onloadend=()=>{j(L=>[...L,i.result].slice(0,8))},i.readAsDataURL(d)})},U=r=>{j(s=>s.filter((d,i)=>i!==r))},A=async r=>{if(r.preventDefault(),!t.title||!t.location||!t.category_id){u({title:"Помилка",description:"Заповніть обов'язкові поля",variant:"destructive"});return}v(!0);try{const{error:s}=await y.from("listings").update({title:t.title,description:t.description||null,category_id:t.category_id||null,price:t.price?Number(t.price):null,currency:t.currency,location:t.location,images:c.length>0?c:null,updated_at:new Date().toISOString()}).eq("id",h).eq("user_id",n.id);if(s)throw s;u({title:"Успішно!",description:"Оголошення оновлено"}),o("/my-listings")}catch(s){u({title:"Помилка",description:s.message||"Не вдалося оновити оголошення",variant:"destructive"})}finally{v(!1)}};return n?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(H,{}),e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:e.jsxs("div",{className:"bg-card rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>o("/my-listings"),children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Редагувати оголошення"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"title",children:"Назва оголошення *"}),e.jsx(b,{id:"title",placeholder:"Наприклад: iPhone 13 Pro Max",value:t.title,onChange:r=>a({...t,title:r.target.value}),required:!0,maxLength:100}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[t.title.length,"/100 символів"]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"category",children:"Категорія *"}),e.jsxs(N,{value:t.category_id,onValueChange:r=>a({...t,category_id:r}),children:[e.jsx(S,{id:"category",children:e.jsx(w,{placeholder:"Оберіть категорію"})}),e.jsx(C,{children:x==null?void 0:x.map(r=>e.jsx(p,{value:r.id,children:r.name_uk},r.id))})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Фотографії"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-2",children:[c.map((r,s)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:r,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>U(s),className:"absolute -top-2 -right-2 bg-destructive text-destructive-foreground rounded-full p-1",children:e.jsx(E,{className:"w-4 h-4"})})]},s)),c.length<8&&e.jsxs("label",{className:"aspect-square border-2 border-dashed border-muted-foreground/25 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-primary transition-colors",children:[e.jsx(V,{className:"w-8 h-8 text-muted-foreground mb-2"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Додати фото"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:_,className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Максимум 8 фотографій"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Опис"}),e.jsx(R,{id:"description",placeholder:"Детальний опис вашого товару або послуги",value:t.description,onChange:r=>a({...t,description:r.target.value}),rows:5,maxLength:2e3}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[t.description.length,"/2000 символів"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"price",children:"Ціна"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(b,{id:"price",type:"number",placeholder:"0",value:t.price,onChange:r=>a({...t,price:r.target.value}),className:"pl-10",min:"0",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"currency",children:"Валюта"}),e.jsxs(N,{value:t.currency,onValueChange:r=>a({...t,currency:r}),children:[e.jsx(S,{id:"currency",children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(p,{value:"UAH",children:"UAH (₴)"}),e.jsx(p,{value:"USD",children:"USD ($)"}),e.jsx(p,{value:"EUR",children:"EUR (€)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"location",children:"Місцезнаходження *"}),e.jsx(P,{value:t.location,onChange:r=>a({...t,location:r}),placeholder:"Оберіть населений пункт...",className:"w-full"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>o("/my-listings"),disabled:g,children:"Скасувати"}),e.jsx(f,{type:"submit",className:"flex-1",disabled:g,children:g?"Збереження...":"Зберегти зміни"})]})]})]})}),e.jsx(k,{})]}):null}export{je as default};
