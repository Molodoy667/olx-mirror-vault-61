import{r as f,h as F,j as e,X as L,t as h,s as b,u as $,B as U}from"./index-KbJkRX07.js";import{a as I}from"./useCategories-C6twurrF.js";import{H as P,b as A}from"./Footer-CG381HwE.js";import{I as S}from"./input-BfmWFPkP.js";import{T as R}from"./textarea-dp5bmWKD.js";import{S as C,d as E,e as _,f as D,g as y}from"./select-CxSQralT.js";import{L as u}from"./label-CwWGJCIM.js";import{L as H}from"./loader-circle-CkyUj1rf.js";import{U as T}from"./upload-C80PTcyb.js";import{K as k}from"./KatottgCityAutocomplete-CQmrrgYI.js";import{D as q}from"./dollar-sign--DFDUvgJ.js";import"./useQuery-DYBXd3SC.js";import"./useAdmin-wN6CKAL8.js";import"./Combination-CN-dILO0.js";import"./badge-DpjjU75J.js";import"./index-D5jjwgwZ.js";import"./index-ohYBQjSJ.js";import"./globe-BvyP_gKp.js";import"./uk-Drv84rxe.js";import"./star-B840Te7u.js";import"./eye-jg7wg44x.js";import"./heart-BstkNJZ-.js";import"./avatar-CGybcn-y.js";import"./user-Dt39FPRe.js";import"./search-B1u6Ento.js";import"./plus-D5zmitre.js";import"./index-CAsdkEwS.js";import"./dialog-C3rICmIe.js";import"./map-pin-0eGOnbmD.js";function V({onImagesChange:p,images:i,maxImages:n=8,bucket:m="listings",folder:j="images"}){const[c,v]=f.useState(!1),t=f.useRef(null),{user:a}=F(),N=async s=>{if(!a)throw new Error("User not authenticated");const l=s.name.split(".").pop(),d=`${j}/${a.id}/${Date.now()}.${l}`,{error:o}=await b.storage.from(m).upload(d,s);if(o)throw o;const{data:{publicUrl:g}}=b.storage.from(m).getPublicUrl(d);return g},r=async s=>{const l=s.target.files;if(!l)return;const d=n-i.length,o=Array.from(l).slice(0,d);if(o.length===0){h({title:"Досягнуто ліміт",description:`Максимум ${n} зображень`,variant:"destructive"});return}v(!0);try{const g=o.map(N),w=await Promise.all(g);p([...i,...w]),h({title:"Успішно",description:`${w.length} зображень завантажено`})}catch(g){h({title:"Помилка",description:g.message||"Не вдалося завантажити зображення",variant:"destructive"})}finally{v(!1),t.current&&(t.current.value="")}},x=async s=>{const l=i[s];try{const o=l.split("/").slice(-3).join("/");await b.storage.from(m).remove([o])}catch(d){console.error("Error deleting image from storage:",d)}p(i.filter((d,o)=>o!==s))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:[i.map((s,l)=>e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>x(l),disabled:c,className:"absolute -top-2 -right-2 bg-destructive text-destructive-foreground rounded-full p-1 hover:bg-destructive/90 transition-colors",children:e.jsx(L,{className:"w-4 h-4"})})]},l)),i.length<n&&e.jsxs("label",{className:"aspect-square border-2 border-dashed border-muted-foreground/25 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-primary transition-colors",children:[c?e.jsx(H,{className:"w-8 h-8 text-muted-foreground animate-spin"}):e.jsx(T,{className:"w-8 h-8 text-muted-foreground mb-2"}),e.jsx("span",{className:"text-xs text-muted-foreground text-center px-2",children:c?"Завантаження...":"Додати фото"}),e.jsx("input",{ref:t,type:"file",accept:"image/*",multiple:!0,onChange:r,disabled:c,className:"hidden"})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Завантажено ",i.length," з ",n," зображень"]})]})}function fe(){const p=$(),{user:i}=F(),{data:n}=I(),[m,j]=f.useState(!1),[c,v]=f.useState([]),[t,a]=f.useState({title:"",description:"",category_id:"",price:"",currency:"UAH",location:""});if(!i)return p("/auth"),null;const N=async r=>{if(r.preventDefault(),!t.title||!t.location||!t.category_id){h({title:"Помилка",description:"Заповніть обов'язкові поля",variant:"destructive"});return}j(!0);try{const{data:x,error:s}=await b.from("listings").insert({user_id:i.id,title:t.title,description:t.description||null,category_id:t.category_id||null,price:t.price?Number(t.price):null,currency:t.currency,location:t.location,images:c.length>0?c:null,status:"active"}).select().single();if(s)throw s;h({title:"Успішно!",description:"Оголошення створено"}),p(`/listing/${x.id}`)}catch(x){h({title:"Помилка",description:x.message||"Не вдалося створити оголошення",variant:"destructive"})}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(P,{}),e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:e.jsxs("div",{className:"bg-card rounded-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Створити оголошення"}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"title",children:"Назва оголошення *"}),e.jsx(S,{id:"title",placeholder:"Наприклад: iPhone 13 Pro Max",value:t.title,onChange:r=>a({...t,title:r.target.value}),required:!0,maxLength:100}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[t.title.length,"/100 символів"]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"category",children:"Категорія *"}),e.jsxs(C,{value:t.category_id,onValueChange:r=>a({...t,category_id:r}),children:[e.jsx(E,{id:"category",children:e.jsx(_,{placeholder:"Оберіть категорію"})}),e.jsx(D,{children:n==null?void 0:n.map(r=>e.jsx(y,{value:r.id,children:r.name_uk},r.id))})]})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Фотографії"}),e.jsx(V,{images:c,onImagesChange:v,maxImages:8,bucket:"listings",folder:"images"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"description",children:"Опис"}),e.jsx(R,{id:"description",placeholder:"Детальний опис вашого товару або послуги",value:t.description,onChange:r=>a({...t,description:r.target.value}),rows:5,maxLength:2e3}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[t.description.length,"/2000 символів"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"price",children:"Ціна"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(S,{id:"price",type:"number",placeholder:"0",value:t.price,onChange:r=>a({...t,price:r.target.value}),className:"pl-10",min:"0",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"currency",children:"Валюта"}),e.jsxs(C,{value:t.currency,onValueChange:r=>a({...t,currency:r}),children:[e.jsx(E,{id:"currency",children:e.jsx(_,{})}),e.jsxs(D,{children:[e.jsx(y,{value:"UAH",children:"UAH (₴)"}),e.jsx(y,{value:"USD",children:"USD ($)"}),e.jsx(y,{value:"EUR",children:"EUR (€)"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"location",children:"Місцезнаходження *"}),e.jsx(k,{value:t.location,onChange:r=>a({...t,location:r}),placeholder:"Оберіть населений пункт...",className:"w-full",showRegionsOnEmpty:!0})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(U,{type:"button",variant:"outline",onClick:()=>p("/"),disabled:m,children:"Скасувати"}),e.jsx(U,{type:"submit",className:"flex-1",disabled:m,children:m?"Створення...":"Опублікувати оголошення"})]})]})]})}),e.jsx(A,{})]})}export{fe as default};
