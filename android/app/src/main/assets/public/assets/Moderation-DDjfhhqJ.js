import{u as Q,r,s as x,t as c,j as e,k as l,p as i,B as d}from"./index-KbJkRX07.js";import{u as W}from"./useAdmin-wN6CKAL8.js";import{A as Y,a as Z}from"./AdminHeader-BFn_Zmrn.js";import{I as ee}from"./input-BfmWFPkP.js";import{S as se,d as ae,e as te,f as re,g as j}from"./select-CxSQralT.js";import{T as le,a as ie,b as R,c as z}from"./tabs-Bq0uXDOJ.js";import{B as f}from"./badge-DpjjU75J.js";import{A as ne,a as ce,b as de}from"./avatar-CGybcn-y.js";import{D as oe,a as me,b as xe,c as he,d as ue}from"./dialog-C3rICmIe.js";import{T as je}from"./textarea-dp5bmWKD.js";import{C as fe}from"./clock-DUppK43j.js";import{F as y}from"./flag-VGL8a-QW.js";import{C}from"./circle-check-big-HnBDMycv.js";import{C as pe}from"./calendar-CuXXWuSH.js";import{S as ge}from"./search-B1u6Ento.js";import{S as B}from"./Combination-CN-dILO0.js";import{C as F}from"./circle-x-CEBvVcIA.js";import{E as I}from"./eye-jg7wg44x.js";import{f as q,u as U}from"./uk-Drv84rxe.js";import"./index-CAsdkEwS.js";import"./users-CUWo_zW8.js";import"./dollar-sign--DFDUvgJ.js";import"./settings-DWrH-Tg4.js";import"./index-D5jjwgwZ.js";import"./index-ohYBQjSJ.js";function Oe(){const h=Q(),{isAdmin:p,loading:g}=W(),[u,V]=r.useState([]),[$,H]=r.useState(!0),[o,M]=r.useState([]),[Ne,P]=r.useState(!0),[m,O]=r.useState(""),[N,X]=r.useState("pending"),[v,S]=r.useState(null),[G,k]=r.useState("");r.useEffect(()=>{!g&&!p&&h("/")},[p,g,h]),r.useEffect(()=>{b(),L()},[]);const b=async()=>{try{const{data:s,error:a}=await x.from("listings").select("*").eq("status","pending").order("created_at",{ascending:!1});if(a)throw a;V(s||[])}catch(s){console.error("Помилка завантаження оголошень:",s),c({title:"Помилка",description:"Не вдалося завантажити оголошення на модерації",variant:"destructive"})}finally{H(!1)}},L=async()=>{try{const{data:s,error:a}=await x.from("reports").select("*").order("created_at",{ascending:!1});if(a)throw a;M(s||[])}catch(s){console.error("Помилка завантаження скарг:",s),c({title:"Помилка",description:"Не вдалося завантажити скарги",variant:"destructive"})}finally{P(!1)}},J=async s=>{try{const{error:a}=await x.from("listings").update({status:"active"}).eq("id",s);if(a)throw a;c({title:"Успішно",description:"Оголошення схвалено та опубліковано"}),b()}catch{c({title:"Помилка",description:"Не вдалося схвалити оголошення",variant:"destructive"})}},K=async(s,a)=>{try{const{error:t}=await x.from("listings").update({status:"rejected"}).eq("id",s);if(t)throw t;c({title:"Успішно",description:"Оголошення відхилено"}),b(),S(null),k("")}catch{c({title:"Помилка",description:"Не вдалося відхилити оголошення",variant:"destructive"})}},T=async(s,a)=>{try{const{error:t}=await x.from("reports").update({status:a==="approved"?"resolved":"dismissed",resolved_at:new Date().toISOString()}).eq("id",s);if(t)throw t;c({title:"Успішно",description:`Скаргу ${a==="approved"?"підтверджено":"відхилено"}`}),L()}catch{c({title:"Помилка",description:"Не вдалося обробити скаргу",variant:"destructive"})}},D=u.filter(s=>s.title.toLowerCase().includes(m.toLowerCase())||s.location.toLowerCase().includes(m.toLowerCase())),_=o.filter(s=>{var n;const a=(((n=s.listings)==null?void 0:n.title)||"").toLowerCase().includes(m.toLowerCase())||s.reason.toLowerCase().includes(m.toLowerCase()),t=N==="all"||s.status===N;return a&&t});return g||$?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):p?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Y,{}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(Z,{})}),e.jsxs("main",{className:"flex-1 p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:"Модерація контенту"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Управління оголошеннями та скаргами користувачів"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{className:"hover:shadow-elevated transition-all duration-300",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"На модерації"}),e.jsx("p",{className:"text-2xl font-bold",children:u.length})]}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-yellow-500/20 to-orange-500/20",children:e.jsx(fe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})})]})})}),e.jsx(l,{className:"hover:shadow-elevated transition-all duration-300",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Активні скарги"}),e.jsx("p",{className:"text-2xl font-bold",children:o.filter(s=>s.status==="pending").length})]}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-red-500/20 to-pink-500/20",children:e.jsx(y,{className:"w-5 h-5 text-red-600 dark:text-red-400"})})]})})}),e.jsx(l,{className:"hover:shadow-elevated transition-all duration-300",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Вирішено сьогодні"}),e.jsx("p",{className:"text-2xl font-bold",children:o.filter(s=>s.resolved_at&&new Date(s.resolved_at).toDateString()===new Date().toDateString()).length})]}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-green-500/20 to-teal-500/20",children:e.jsx(C,{className:"w-5 h-5 text-green-600 dark:text-green-400"})})]})})}),e.jsx(l,{className:"hover:shadow-elevated transition-all duration-300",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Середній час обробки"}),e.jsx("p",{className:"text-2xl font-bold",children:"2.5г"})]}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-blue-500/20 to-cyan-500/20",children:e.jsx(pe,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})})]})})})]}),e.jsx(l,{className:"mb-6",children:e.jsx(i,{className:"p-4",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(ee,{placeholder:"Пошук оголошень або скарг...",value:m,onChange:s=>O(s.target.value),className:"pl-10"})]})})})}),e.jsxs(le,{defaultValue:"listings",className:"space-y-6",children:[e.jsxs(ie,{className:"grid w-full grid-cols-2 lg:w-auto lg:grid-cols-2",children:[e.jsxs(R,{value:"listings",className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Оголошення на модерації",u.length>0&&e.jsx(f,{variant:"secondary",className:"ml-2",children:u.length})]}),e.jsxs(R,{value:"reports",className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Скарги користувачів",o.filter(s=>s.status==="pending").length>0&&e.jsx(f,{variant:"destructive",className:"ml-2",children:o.filter(s=>s.status==="pending").length})]})]}),e.jsx(z,{value:"listings",className:"space-y-4",children:D.length===0?e.jsx(l,{children:e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(B,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Немає оголошень на модерації"}),e.jsx("p",{className:"text-muted-foreground",children:"Всі оголошення модеровані або автоматичне схвалення увімкнено"})]})}):e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:D.map(s=>{var a,t,n,A,E;return e.jsx(l,{className:"overflow-hidden",children:e.jsxs(i,{className:"p-0",children:[s.images&&s.images.length>0&&e.jsxs("div",{className:"relative h-48 bg-muted",children:[e.jsx("img",{src:s.images[0],alt:s.title,className:"w-full h-full object-cover",onError:w=>{w.currentTarget.style.display="none"}}),s.images.length>1&&e.jsxs(f,{className:"absolute top-2 right-2",children:["+",s.images.length-1," фото"]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.title}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:s.location}),s.price&&e.jsxs("span",{className:"font-medium text-foreground",children:[s.price.toLocaleString("uk-UA")," ",s.currency]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ne,{className:"w-8 h-8",children:[e.jsx(ce,{src:(a=s.profiles)==null?void 0:a.avatar_url}),e.jsx(de,{children:(((t=s.profiles)==null?void 0:t.full_name)||((n=s.profiles)==null?void 0:n.username)||"U")[0].toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:((A=s.profiles)==null?void 0:A.full_name)||((E=s.profiles)==null?void 0:E.username)||"Анонімний користувач"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:q(new Date(s.created_at),{addSuffix:!0,locale:U})})]})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[e.jsxs(d,{onClick:()=>J(s.id),className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Схвалити"]}),e.jsxs(oe,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(d,{variant:"destructive",className:"flex-1",size:"sm",onClick:()=>S(s),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Відхилити"]})}),e.jsxs(xe,{children:[e.jsx(he,{children:e.jsx(ue,{children:"Відхилення оголошення"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Ви відхиляєте оголошення: "',v==null?void 0:v.title,'"']}),e.jsx(je,{placeholder:"Причина відхилення (необов'язково)",value:G,onChange:w=>k(w.target.value)}),e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{variant:"destructive",onClick:()=>K(s.id),className:"flex-1",children:"Підтвердити відхилення"})})]})]})]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>h(`/listing/${s.id}`),children:e.jsx(I,{className:"w-4 h-4"})})]})]})]})},s.id)})})}),e.jsxs(z,{value:"reports",className:"space-y-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(se,{value:N,onValueChange:X,children:[e.jsx(ae,{className:"w-full sm:w-[200px]",children:e.jsx(te,{placeholder:"Статус скарги"})}),e.jsxs(re,{children:[e.jsx(j,{value:"all",children:"Всі скарги"}),e.jsx(j,{value:"pending",children:"Очікують обробки"}),e.jsx(j,{value:"resolved",children:"Вирішені"}),e.jsx(j,{value:"dismissed",children:"Відхилені"})]})]})}),_.length===0?e.jsx(l,{children:e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Немає скарг"}),e.jsx("p",{className:"text-muted-foreground",children:"Скарги від користувачів будуть відображатися тут"})]})}):e.jsx("div",{className:"space-y-4",children:_.map(s=>{var a,t,n;return e.jsx(l,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:s.status==="pending"?"destructive":s.status==="resolved"?"default":"secondary",children:s.status==="pending"?"Очікує":s.status==="resolved"?"Вирішено":"Відхилено"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:q(new Date(s.created_at),{addSuffix:!0,locale:U})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:["Скарга на: ",((a=s.listings)==null?void 0:a.title)||"Видалене оголошення"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Причина: ",s.reason]}),s.description&&e.jsx("p",{className:"text-sm mt-2",children:s.description})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Від: ",((t=s.profiles)==null?void 0:t.full_name)||((n=s.profiles)==null?void 0:n.username)||"Анонім"]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",onClick:()=>T(s.id,"approved"),className:"bg-green-600 hover:bg-green-700",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>T(s.id,"dismissed"),children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>h(`/listing/${s.listing_id}`),children:e.jsx(I,{className:"w-4 h-4"})})]})]})})},s.id)})})]})]})]})]})]}):null}export{Oe as default};
