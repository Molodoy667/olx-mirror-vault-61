import{u as A,r as n,s as l,t as c,j as e,B as d}from"./index-KbJkRX07.js";import{u as B}from"./useAdmin-wN6CKAL8.js";import{A as z,a as I}from"./AdminHeader-BFn_Zmrn.js";import{I as $}from"./input-BfmWFPkP.js";import{S as q,d as H,e as F,f as M,g as p}from"./select-CxSQralT.js";import{T as R,a as V,b as g,c as a,d as D,e as i}from"./table--IrP7ivg.js";import{B as N}from"./badge-DpjjU75J.js";import{S as O}from"./search-B1u6Ento.js";import{M as P}from"./map-pin-0eGOnbmD.js";import{E as b}from"./eye-jg7wg44x.js";import{E as U}from"./eye-off-DmAdVWQx.js";import{T as G}from"./trash-2-CCvey3Fk.js";import"./Combination-CN-dILO0.js";import"./index-CAsdkEwS.js";import"./users-CUWo_zW8.js";import"./dollar-sign--DFDUvgJ.js";import"./settings-DWrH-Tg4.js";import"./index-D5jjwgwZ.js";function me(){const m=A(),{isAdmin:h,loading:x}=B(),[v,w]=n.useState([]),[u,y]=n.useState(""),[j,S]=n.useState("all"),[L,C]=n.useState(!0);n.useEffect(()=>{!x&&!h&&m("/")},[h,x,m]),n.useEffect(()=>{o()},[]);const o=async()=>{try{const{data:s,error:t}=await l.from("listings").select(`
          *,
          categories:category_id(name_uk)
        `).order("created_at",{ascending:!1});if(t)throw t;w(s||[])}catch(s){console.error("Error loading listings:",s),c({title:"Помилка",description:"Не вдалося завантажити оголошення",variant:"destructive"})}finally{C(!1)}},T=async(s,t)=>{const r=t==="active"?"inactive":"active";try{const{error:f}=await l.from("listings").update({status:r}).eq("id",s);if(f)throw f;c({title:"Успішно",description:`Оголошення ${r==="active"?"активоване":"деактивоване"}`}),o()}catch{c({title:"Помилка",description:"Не вдалося змінити статус",variant:"destructive"})}},k=async(s,t)=>{try{const{error:r}=await l.from("listings").update({is_promoted:!t}).eq("id",s);if(r)throw r;c({title:"Успішно",description:t?"Промо знято":"Оголошення промо"}),o()}catch{c({title:"Помилка",description:"Не вдалося змінити промо статус",variant:"destructive"})}},E=async s=>{if(confirm("Ви впевнені, що хочете видалити це оголошення?"))try{const{error:t}=await l.from("listings").delete().eq("id",s);if(t)throw t;c({title:"Успішно",description:"Оголошення видалено"}),o()}catch{c({title:"Помилка",description:"Не вдалося видалити оголошення",variant:"destructive"})}},_=v.filter(s=>{const t=s.title.toLowerCase().includes(u.toLowerCase())||s.location.toLowerCase().includes(u.toLowerCase()),r=j==="all"||s.status===j;return t&&r});return x||L?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):h?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(I,{})}),e.jsxs("main",{className:"flex-1 p-4 md:p-6 lg:p-8 overflow-x-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:"Управління оголошеннями"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Всього оголошень: ",v.length]})]}),e.jsx("div",{className:"bg-card rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx($,{placeholder:"Пошук оголошень...",value:u,onChange:s=>y(s.target.value),className:"pl-10"})]}),e.jsxs(q,{value:j,onValueChange:S,children:[e.jsx(H,{children:e.jsx(F,{placeholder:"Фільтр за статусом"})}),e.jsxs(M,{children:[e.jsx(p,{value:"all",children:"Всі статуси"}),e.jsx(p,{value:"active",children:"Активні"}),e.jsx(p,{value:"inactive",children:"Неактивні"})]})]})]})}),e.jsx("div",{className:"bg-card rounded-lg overflow-hidden",children:e.jsxs(R,{children:[e.jsx(V,{children:e.jsxs(g,{children:[e.jsx(a,{children:"Оголошення"}),e.jsx(a,{children:"Категорія"}),e.jsx(a,{children:"Автор"}),e.jsx(a,{children:"Ціна"}),e.jsx(a,{children:"Статус"}),e.jsx(a,{children:"Промо"}),e.jsx(a,{children:"Перегляди"}),e.jsx(a,{className:"text-right",children:"Дії"})]})}),e.jsx(D,{children:_.map(s=>{var t;return e.jsxs(g,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),s.location]})]})}),e.jsx(i,{children:e.jsx(N,{variant:"outline",children:((t=s.categories)==null?void 0:t.name_uk)||"—"})}),e.jsxs(i,{children:["ID: ",s.user_id.slice(0,8),"..."]}),e.jsx(i,{children:s.price?`${s.price.toLocaleString("uk-UA")} ${s.currency}`:"Безкоштовно"}),e.jsx(i,{children:e.jsx(N,{variant:s.status==="active"?"default":"secondary",children:s.status==="active"?"Активне":"Неактивне"})}),e.jsx(i,{children:e.jsx(d,{variant:s.is_promoted?"default":"outline",size:"sm",onClick:()=>k(s.id,s.is_promoted),children:s.is_promoted?"Промо":"Звичайне"})}),e.jsx(i,{children:s.views}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>m(`/listing/${s.id}`),children:e.jsx(b,{className:"w-4 h-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>T(s.id,s.status),children:s.status==="active"?e.jsx(U,{className:"w-4 h-4"}):e.jsx(b,{className:"w-4 h-4"})}),e.jsx(d,{variant:"destructive",size:"icon",onClick:()=>E(s.id),children:e.jsx(G,{className:"w-4 h-4"})})]})})]},s.id)})})]})})]})]})]}):null}export{me as default};
