import{u as se,r as i,s as f,t as _,j as e,k as d,p as o,B as N}from"./index-KbJkRX07.js";import{u as ae}from"./useAdmin-wN6CKAL8.js";import{A as te,a as le}from"./AdminHeader-BFn_Zmrn.js";import{I as re}from"./input-BfmWFPkP.js";import{T as ie,a as ne,b as E,c as m,d as ce,e as x}from"./table--IrP7ivg.js";import{B as v}from"./badge-DpjjU75J.js";import{S as M,d as z,e as F,f as H,g as n}from"./select-CxSQralT.js";import{D as de,b as oe,c as me,d as xe}from"./dialog-C3rICmIe.js";import{a as U}from"./Combination-CN-dILO0.js";import{C as V}from"./clock-DUppK43j.js";import{C as k}from"./circle-check-big-HnBDMycv.js";import{C as b}from"./circle-x-CEBvVcIA.js";import{S as he}from"./search-B1u6Ento.js";import{U as je}from"./user-Dt39FPRe.js";import{E as O}from"./eye-jg7wg44x.js";import{T as ue}from"./triangle-alert-Djs7j-Tu.js";import"./index-CAsdkEwS.js";import"./users-CUWo_zW8.js";import"./dollar-sign--DFDUvgJ.js";import"./settings-DWrH-Tg4.js";import"./index-D5jjwgwZ.js";function ze(){var I;const w=se(),{isAdmin:S,loading:C}=ae(),[h,$]=i.useState([]),[j,q]=i.useState(""),[y,P]=i.useState("all"),[R,W]=i.useState("all"),[X,G]=i.useState(!0),[t,J]=i.useState(null),[K,D]=i.useState(!1);i.useEffect(()=>{!C&&!S&&w("/")},[S,C,w]),i.useEffect(()=>{T()},[]);const T=async()=>{try{const{data:s,error:r}=await f.from("reports").select("*").order("created_at",{ascending:!1});if(r)throw r;const l=[...new Set(s.map(a=>a.user_id))].filter(Boolean),c=[...new Set(s.map(a=>a.listing_id))].filter(Boolean),[p,g]=await Promise.all([l.length>0?f.from("profiles").select("id, full_name, username").in("id",l):{data:[]},c.length>0?f.from("listings").select("id, title").in("id",c):{data:[]}]),Y=new Map((p.data||[]).map(a=>[a.id,a])),Z=new Map((g.data||[]).map(a=>[a.id,a])),ee=s.map(a=>({...a,status:a.status,profiles:Y.get(a.user_id),listings:Z.get(a.listing_id)}));$(ee)}catch(s){console.error("Error loading reports:",s),_({title:"Помилка",description:"Не вдалося завантажити скарги",variant:"destructive"})}finally{G(!1)}},L=async(s,r)=>{try{const{error:l}=await f.from("reports").update({status:r,resolved_at:new Date().toISOString()}).eq("id",s);if(l)throw l;_({title:"Успішно",description:`Скаргу ${r==="resolved"?"вирішено":"відхилено"}`}),T(),D(!1)}catch{_({title:"Помилка",description:"Не вдалося оновити статус скарги",variant:"destructive"})}},A=s=>{switch(s){case"pending":return e.jsxs(v,{variant:"outline",className:"text-yellow-600 border-yellow-200 bg-yellow-50",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),"Очікує"]});case"resolved":return e.jsxs(v,{variant:"outline",className:"text-green-600 border-green-200 bg-green-50",children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Вирішено"]});case"rejected":return e.jsxs(v,{variant:"outline",className:"text-red-600 border-red-200 bg-red-50",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Відхилено"]});default:return e.jsx(v,{children:s})}},B=s=>{switch(s.toLowerCase()){case"spam":return e.jsx(ue,{className:"w-4 h-4 text-orange-500"});case"fraud":return e.jsx(b,{className:"w-4 h-4 text-red-500"});case"inappropriate":return e.jsx(O,{className:"w-4 h-4 text-purple-500"});default:return e.jsx(U,{className:"w-4 h-4 text-blue-500"})}},Q=h.filter(s=>{var p,g;const r=(((p=s.listings)==null?void 0:p.title)||"").toLowerCase().includes(j.toLowerCase())||s.reason.toLowerCase().includes(j.toLowerCase())||(((g=s.profiles)==null?void 0:g.full_name)||"").toLowerCase().includes(j.toLowerCase()),l=y==="all"||s.status===y,c=R==="all"||s.reason===R;return r&&l&&c}),u={total:h.length,pending:h.filter(s=>s.status==="pending").length,resolved:h.filter(s=>s.status==="resolved").length,rejected:h.filter(s=>s.status==="rejected").length};return C||X?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):S?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(te,{}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(le,{})}),e.jsxs("main",{className:"flex-1 p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:"Управління скаргами"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Модерація повідомлень користувачів"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Всього"}),e.jsx("p",{className:"text-2xl font-bold",children:u.total})]})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-8 h-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Очікують"}),e.jsx("p",{className:"text-2xl font-bold",children:u.pending})]})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Вирішено"}),e.jsx("p",{className:"text-2xl font-bold",children:u.resolved})]})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"w-8 h-8 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Відхилено"}),e.jsx("p",{className:"text-2xl font-bold",children:u.rejected})]})]})})})]}),e.jsx(d,{className:"mb-6",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(re,{placeholder:"Пошук скарг...",value:j,onChange:s=>q(s.target.value),className:"pl-10"})]}),e.jsxs(M,{value:y,onValueChange:P,children:[e.jsx(z,{children:e.jsx(F,{placeholder:"Статус"})}),e.jsxs(H,{children:[e.jsx(n,{value:"all",children:"Всі статуси"}),e.jsx(n,{value:"pending",children:"Очікують"}),e.jsx(n,{value:"resolved",children:"Вирішено"}),e.jsx(n,{value:"rejected",children:"Відхилено"})]})]}),e.jsxs(M,{value:R,onValueChange:W,children:[e.jsx(z,{children:e.jsx(F,{placeholder:"Причина"})}),e.jsxs(H,{children:[e.jsx(n,{value:"all",children:"Всі причини"}),e.jsx(n,{value:"spam",children:"Спам"}),e.jsx(n,{value:"fraud",children:"Шахрайство"}),e.jsx(n,{value:"inappropriate",children:"Неприйнятний контент"}),e.jsx(n,{value:"other",children:"Інше"})]})]})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-0",children:e.jsxs(ie,{children:[e.jsx(ne,{children:e.jsxs(E,{children:[e.jsx(m,{children:"Оголошення"}),e.jsx(m,{children:"Автор скарги"}),e.jsx(m,{children:"Причина"}),e.jsx(m,{children:"Статус"}),e.jsx(m,{children:"Дата"}),e.jsx(m,{className:"text-right",children:"Дії"})]})}),e.jsx(ce,{children:Q.map(s=>{var r,l,c;return e.jsxs(E,{children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((r=s.listings)==null?void 0:r.title)||"Видалене оголошення"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",s.listing_id.slice(0,8),"..."]})]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((l=s.profiles)==null?void 0:l.full_name)||((c=s.profiles)==null?void 0:c.username)||"Анонім"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.user_id.slice(0,8),"..."]})]})]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[B(s.reason),e.jsx("span",{className:"capitalize",children:s.reason})]})}),e.jsx(x,{children:A(s.status)}),e.jsx(x,{children:new Date(s.created_at).toLocaleDateString("uk-UA")}),e.jsx(x,{className:"text-right",children:e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{J(s),D(!0)},children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Деталі"]})})]},s.id)})})]})})}),e.jsx(de,{open:K,onOpenChange:D,children:e.jsxs(oe,{className:"sm:max-w-lg",children:[e.jsx(me,{children:e.jsx(xe,{children:"Деталі скарги"})}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Оголошення"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((I=t.listings)==null?void 0:I.title)||"Видалене оголошення"}),e.jsx(N,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>w(`/listing/${t.listing_id}`),children:"Переглянути оголошення"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Причина скарги"}),e.jsxs("div",{className:"flex items-center gap-2",children:[B(t.reason),e.jsx("span",{className:"capitalize",children:t.reason})]})]}),t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Опис"}),e.jsx("div",{className:"p-3 bg-muted rounded-lg text-sm",children:t.description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Статус"}),A(t.status)]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Дата створення"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(t.created_at).toLocaleString("uk-UA")})]}),t.status==="pending"&&e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsxs(N,{onClick:()=>L(t.id,"resolved"),className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Вирішити"]}),e.jsxs(N,{variant:"destructive",onClick:()=>L(t.id,"rejected"),className:"flex-1",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Відхилити"]})]})]})]})})]})]})]}):null}export{ze as default};
