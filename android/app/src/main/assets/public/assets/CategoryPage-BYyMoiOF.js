import{w as v,u as N,r as d,s as u,j as e,B as p}from"./index-KbJkRX07.js";import{u as x}from"./useQuery-DYBXd3SC.js";import{H as b,b as y}from"./Footer-CG381HwE.js";import{P as w}from"./ProductCardNew-DTAZEOFN.js";import{I as _}from"./input-BfmWFPkP.js";import{a as k,S as q}from"./separator-D_BKHY2d.js";import{C}from"./chevron-left-BOtSwr66.js";import"./useAdmin-wN6CKAL8.js";import"./Combination-CN-dILO0.js";import"./badge-DpjjU75J.js";import"./index-D5jjwgwZ.js";import"./select-CxSQralT.js";import"./index-ohYBQjSJ.js";import"./globe-BvyP_gKp.js";import"./uk-Drv84rxe.js";import"./star-B840Te7u.js";import"./eye-jg7wg44x.js";import"./heart-BstkNJZ-.js";import"./avatar-CGybcn-y.js";import"./user-Dt39FPRe.js";import"./search-B1u6Ento.js";import"./plus-D5zmitre.js";import"./useMutation-BJki3aSv.js";import"./map-pin-0eGOnbmD.js";function Y(){const{slug:o}=v(),m=N(),[c,g]=d.useState(""),[t,h]=d.useState([0,1e5]),[l,j]=d.useState("date"),{data:a}=x({queryKey:["category",o],queryFn:async()=>{const{data:s,error:r}=await u.from("categories").select("*").eq("slug",o).single();if(r)throw r;return s}}),{data:i,isLoading:f}=x({queryKey:["category-listings",a==null?void 0:a.id,c,t,l],queryFn:async()=>{if(!a)return[];let s=u.from("listings").select("*").eq("status","active").eq("category_id",a.id);switch(c&&(s=s.ilike("location",`%${c}%`)),t[0]>0&&(s=s.gte("price",t[0])),t[1]<1e5&&(s=s.lte("price",t[1])),l){case"price_asc":s=s.order("price",{ascending:!0,nullsFirst:!1});break;case"price_desc":s=s.order("price",{ascending:!1,nullsFirst:!1});break;default:s=s.order("is_promoted",{ascending:!1}).order("created_at",{ascending:!1})}const{data:r,error:n}=await s;if(n)throw n;return r},enabled:!!a});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(b,{}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>m("/"),children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"Головна"]}),e.jsx("span",{className:"text-muted-foreground",children:"/"}),e.jsx("span",{className:"font-medium",children:a==null?void 0:a.name_uk})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"lg:w-64",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Фільтри"}),e.jsx(k,{}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Місцезнаходження"}),e.jsx(_,{placeholder:"Місто або область",value:c,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Ціна: ",t[0]," - ",t[1]," грн"]}),e.jsx(q,{value:t,onValueChange:s=>h(s),max:1e5,step:100,className:"mt-3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Сортування"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:l,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"date",children:"Найновіші"}),e.jsx("option",{value:"price_asc",children:"Дешевші"}),e.jsx("option",{value:"price_desc",children:"Дорожчі"})]})]})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-card rounded-lg p-4 mb-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:a==null?void 0:a.name_uk}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Знайдено ",(i==null?void 0:i.length)||0," оголошень"]})]}),f?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((s,r)=>e.jsxs("div",{className:"bg-card rounded-lg p-4 animate-pulse",children:[e.jsx("div",{className:"aspect-square bg-muted rounded-lg mb-3"}),e.jsx("div",{className:"h-4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]},r))}):i&&i.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:i.map(s=>{var r;return e.jsx(w,{id:s.id,title:s.title,price:s.price||0,currency:s.currency,location:s.location,image:((r=s.images)==null?void 0:r[0])||"/placeholder.svg",isPromoted:s.is_promoted,createdAt:s.created_at},s.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"У цій категорії поки немає оголошень"}),e.jsx(p,{onClick:()=>m("/create"),className:"mt-4",children:"Створити перше оголошення"})]})]})]})]}),e.jsx(y,{})]})}export{Y as default};
