import{h as j,v as L,s as c,t as h,u as C,j as e,k as P,B as S,g as x}from"./index-KbJkRX07.js";import{B as u}from"./badge-DpjjU75J.js";import{u as p}from"./useQuery-DYBXd3SC.js";import{u as B}from"./useMutation-BJki3aSv.js";import{H as E}from"./heart-BstkNJZ-.js";import{M as K}from"./map-pin-0eGOnbmD.js";import{E as M}from"./eye-jg7wg44x.js";import{f as Q,u as F}from"./uk-Drv84rxe.js";const H=t=>{const{user:r}=j(),i=L(),{data:o}=p({queryKey:["listing-user-like",t,r==null?void 0:r.id],queryFn:async()=>{if(!r)return null;const{data:s,error:a}=await c.from("listing_likes").select("*").eq("listing_id",t).eq("user_id",r.id).maybeSingle();if(a)throw a;return s},enabled:!!r&&!!t}),{data:d}=p({queryKey:["listing-likes-stats",t],queryFn:async()=>{const{data:s,error:a}=await c.from("listing_stats").select("likes_total").eq("listing_id",t).maybeSingle();if(a)throw a;return(s==null?void 0:s.likes_total)||0},enabled:!!t}),l=B({mutationFn:async()=>{if(!r)throw new Error("Необходимо войти в систему");if(o){const{error:s}=await c.from("listing_likes").delete().eq("listing_id",t).eq("user_id",r.id);if(s)throw s;return!1}else{const{error:s}=await c.from("listing_likes").insert({listing_id:t,user_id:r.id});if(s)throw s;return!0}},onSuccess:s=>{i.invalidateQueries({queryKey:["listing-user-like",t]}),i.invalidateQueries({queryKey:["listing-likes-stats",t]}),h({title:s?"Додано в обрані":"Видалено з обраних",description:s?"Оголошення збережено в ваших обраних":"Оголошення видалено з обраних"})},onError:s=>{h({title:"Помилка",description:s.message||"Не вдалося оновити статус",variant:"destructive"})}});return{isLiked:!!o,likesCount:d||0,toggleLike:l.mutate,isLoading:l.isPending}},J=({id:t,title:r,price:i,currency:o="UAH",location:d,image:l,isPromoted:s=!1,createdAt:a,views:m=0,userId:$,condition:v,negotiable:b=!0})=>{const g=C(),{user:w}=j(),{isLiked:f,toggleLike:k,isLoading:y}=H(t),N=n=>{n.target.closest("button")||g(`/listing/${t}`)},q=n=>{if(n.stopPropagation(),!w){g("/auth");return}k()},_=n=>{switch(n){case"new":return e.jsx(u,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Новий"});case"refurbished":return e.jsx(u,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Відновлений"});default:return null}};return e.jsxs(P,{className:"group cursor-pointer hover:shadow-lg transition-all duration-200 overflow-hidden",onClick:N,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-muted",children:e.jsx("img",{src:l,alt:r,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),e.jsx("div",{className:"absolute top-2 left-2 flex gap-2",children:s&&e.jsx(u,{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white font-bold",children:"VIP"})}),e.jsx(S,{variant:"ghost",size:"icon",className:x("absolute top-2 right-2 bg-white/80 hover:bg-white transition-colors",f&&"text-red-500"),onClick:q,disabled:y,children:e.jsx(E,{className:x("w-4 h-4",f&&"fill-current")})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2 group-hover:text-primary transition-colors",children:r}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:i>0?`${i.toLocaleString("uk-UA")} ${o}`:"Безкоштовно"}),b&&i>0&&e.jsx(u,{variant:"outline",className:"text-xs",children:"Торг"})]}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:_(v)}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:d})]}),m>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:m})]})]}),a&&e.jsx("div",{className:"text-sm text-muted-foreground",children:Q(new Date(a),{addSuffix:!0,locale:F})})]})]})};export{J as P};
