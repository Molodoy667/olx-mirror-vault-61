import{r as j,j as e,g as E,X as Oe,u as U,h as I,s as v,k as C,t as N,v as V,B as k,w as Te,C as De}from"./index-KbJkRX07.js";import{u as M}from"./useQuery-DYBXd3SC.js";import{C as ie,H as B,b as G}from"./Footer-CG381HwE.js";import{D as z,b as Z,a as fe,c as xe,d as ge,e as pe}from"./dialog-C3rICmIe.js";import{E as qe,d as Pe,e as Ee,f as Me,g as Fe,h as Ye,C as We,M as Le,S as $e,b as He,i as Ie,T as Re,a as Qe}from"./BusinessProfileBadge-DqqqoEKX.js";import{C as ce}from"./chevron-left-BOtSwr66.js";import{H as we}from"./heart-BstkNJZ-.js";import{M as J}from"./map-pin-0eGOnbmD.js";import{u as W}from"./useMutation-BJki3aSv.js";import{T as L}from"./textarea-dp5bmWKD.js";import{A as ee,a as te,b as se}from"./avatar-CGybcn-y.js";import{a as re,S as K,P as Ae}from"./Combination-CN-dILO0.js";import{S as X}from"./star-B840Te7u.js";import{U as ae}from"./user-Dt39FPRe.js";import{s as $,t as O,c as q,g as oe,m as Be,a as je,b as ne,e as Ge,f as H,u as F}from"./uk-Drv84rxe.js";import{C as Xe}from"./circle-check-big-HnBDMycv.js";import{B as ve}from"./badge-DpjjU75J.js";import{Z as Ke}from"./zap-DlrJUmUk.js";import{T as Ue}from"./tag-BAG7-RLY.js";import{C as Ve}from"./clock-DUppK43j.js";import{E as be}from"./eye-jg7wg44x.js";import{S as ze,d as Ze,e as Je,f as et,g as tt}from"./select-CxSQralT.js";import{L as R}from"./label-CwWGJCIM.js";import{F as st}from"./flag-VGL8a-QW.js";import{C as rt}from"./calendar-CuXXWuSH.js";import{T as at}from"./trending-up-V0CF97wQ.js";import{T as nt}from"./triangle-alert-Djs7j-Tu.js";import{D as Ne}from"./dollar-sign--DFDUvgJ.js";import{I as it}from"./input-BfmWFPkP.js";import"./useAdmin-wN6CKAL8.js";import"./index-D5jjwgwZ.js";import"./index-ohYBQjSJ.js";import"./globe-BvyP_gKp.js";import"./search-B1u6Ento.js";import"./plus-D5zmitre.js";import"./index-CAsdkEwS.js";import"./arrow-left-8vQ30E0Z.js";import"./arrow-right-Dl6NkRd5.js";function Q(t){return $(t,{weekStartsOn:1})}function ye(t){const r=O(t),s=r.getFullYear(),a=q(t,0);a.setFullYear(s+1,0,4),a.setHours(0,0,0,0);const i=Q(a),n=q(t,0);n.setFullYear(s,0,4),n.setHours(0,0,0,0);const c=Q(n);return r.getTime()>=i.getTime()?s+1:r.getTime()>=c.getTime()?s:s-1}function le(t){const r=O(t);return r.setHours(0,0,0,0),r}function ct(t,r){const s=le(t),a=le(r),i=+s-oe(s),n=+a-oe(a);return Math.round((i-n)/Be)}function ot(t){const r=ye(t),s=q(t,0);return s.setFullYear(r,0,4),s.setHours(0,0,0,0),Q(s)}function lt(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function dt(t){if(!lt(t)&&typeof t!="number")return!1;const r=O(t);return!isNaN(Number(r))}function ut(t){const r=O(t),s=q(t,0);return s.setFullYear(r.getFullYear(),0,1),s.setHours(0,0,0,0),s}function mt(t){const r=O(t);return ct(r,ut(r))+1}function ht(t){const r=O(t),s=+Q(r)-+ot(r);return Math.round(s/je)+1}function ke(t,r){var o,x,p,u;const s=O(t),a=s.getFullYear(),i=ne(),n=(r==null?void 0:r.firstWeekContainsDate)??((x=(o=r==null?void 0:r.locale)==null?void 0:o.options)==null?void 0:x.firstWeekContainsDate)??i.firstWeekContainsDate??((u=(p=i.locale)==null?void 0:p.options)==null?void 0:u.firstWeekContainsDate)??1,c=q(t,0);c.setFullYear(a+1,0,n),c.setHours(0,0,0,0);const h=$(c,r),l=q(t,0);l.setFullYear(a,0,n),l.setHours(0,0,0,0);const m=$(l,r);return s.getTime()>=h.getTime()?a+1:s.getTime()>=m.getTime()?a:a-1}function ft(t,r){var h,l,m,o;const s=ne(),a=(r==null?void 0:r.firstWeekContainsDate)??((l=(h=r==null?void 0:r.locale)==null?void 0:h.options)==null?void 0:l.firstWeekContainsDate)??s.firstWeekContainsDate??((o=(m=s.locale)==null?void 0:m.options)==null?void 0:o.firstWeekContainsDate)??1,i=ke(t,r),n=q(t,0);return n.setFullYear(i,0,a),n.setHours(0,0,0,0),$(n,r)}function xt(t,r){const s=O(t),a=+$(s,r)-+ft(s,r);return Math.round(a/je)+1}function w(t,r){const s=t<0?"-":"",a=Math.abs(t).toString().padStart(r,"0");return s+a}const T={y(t,r){const s=t.getFullYear(),a=s>0?s:1-s;return w(r==="yy"?a%100:a,r.length)},M(t,r){const s=t.getMonth();return r==="M"?String(s+1):w(s+1,2)},d(t,r){return w(t.getDate(),r.length)},a(t,r){const s=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(t,r){return w(t.getHours()%12||12,r.length)},H(t,r){return w(t.getHours(),r.length)},m(t,r){return w(t.getMinutes(),r.length)},s(t,r){return w(t.getSeconds(),r.length)},S(t,r){const s=r.length,a=t.getMilliseconds(),i=Math.trunc(a*Math.pow(10,s-3));return w(i,r.length)}},P={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},de={G:function(t,r,s){const a=t.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})}},y:function(t,r,s){if(r==="yo"){const a=t.getFullYear(),i=a>0?a:1-a;return s.ordinalNumber(i,{unit:"year"})}return T.y(t,r)},Y:function(t,r,s,a){const i=ke(t,a),n=i>0?i:1-i;if(r==="YY"){const c=n%100;return w(c,2)}return r==="Yo"?s.ordinalNumber(n,{unit:"year"}):w(n,r.length)},R:function(t,r){const s=ye(t);return w(s,r.length)},u:function(t,r){const s=t.getFullYear();return w(s,r.length)},Q:function(t,r,s){const a=Math.ceil((t.getMonth()+1)/3);switch(r){case"Q":return String(a);case"QQ":return w(a,2);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,r,s){const a=Math.ceil((t.getMonth()+1)/3);switch(r){case"q":return String(a);case"qq":return w(a,2);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,r,s){const a=t.getMonth();switch(r){case"M":case"MM":return T.M(t,r);case"Mo":return s.ordinalNumber(a+1,{unit:"month"});case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})}},L:function(t,r,s){const a=t.getMonth();switch(r){case"L":return String(a+1);case"LL":return w(a+1,2);case"Lo":return s.ordinalNumber(a+1,{unit:"month"});case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})}},w:function(t,r,s,a){const i=xt(t,a);return r==="wo"?s.ordinalNumber(i,{unit:"week"}):w(i,r.length)},I:function(t,r,s){const a=ht(t);return r==="Io"?s.ordinalNumber(a,{unit:"week"}):w(a,r.length)},d:function(t,r,s){return r==="do"?s.ordinalNumber(t.getDate(),{unit:"date"}):T.d(t,r)},D:function(t,r,s){const a=mt(t);return r==="Do"?s.ordinalNumber(a,{unit:"dayOfYear"}):w(a,r.length)},E:function(t,r,s){const a=t.getDay();switch(r){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})}},e:function(t,r,s,a){const i=t.getDay(),n=(i-a.weekStartsOn+8)%7||7;switch(r){case"e":return String(n);case"ee":return w(n,2);case"eo":return s.ordinalNumber(n,{unit:"day"});case"eee":return s.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(i,{width:"short",context:"formatting"});case"eeee":default:return s.day(i,{width:"wide",context:"formatting"})}},c:function(t,r,s,a){const i=t.getDay(),n=(i-a.weekStartsOn+8)%7||7;switch(r){case"c":return String(n);case"cc":return w(n,r.length);case"co":return s.ordinalNumber(n,{unit:"day"});case"ccc":return s.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(i,{width:"narrow",context:"standalone"});case"cccccc":return s.day(i,{width:"short",context:"standalone"});case"cccc":default:return s.day(i,{width:"wide",context:"standalone"})}},i:function(t,r,s){const a=t.getDay(),i=a===0?7:a;switch(r){case"i":return String(i);case"ii":return w(i,r.length);case"io":return s.ordinalNumber(i,{unit:"day"});case"iii":return s.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(a,{width:"short",context:"formatting"});case"iiii":default:return s.day(a,{width:"wide",context:"formatting"})}},a:function(t,r,s){const i=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,r,s){const a=t.getHours();let i;switch(a===12?i=P.noon:a===0?i=P.midnight:i=a/12>=1?"pm":"am",r){case"b":case"bb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,r,s){const a=t.getHours();let i;switch(a>=17?i=P.evening:a>=12?i=P.afternoon:a>=4?i=P.morning:i=P.night,r){case"B":case"BB":case"BBB":return s.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,r,s){if(r==="ho"){let a=t.getHours()%12;return a===0&&(a=12),s.ordinalNumber(a,{unit:"hour"})}return T.h(t,r)},H:function(t,r,s){return r==="Ho"?s.ordinalNumber(t.getHours(),{unit:"hour"}):T.H(t,r)},K:function(t,r,s){const a=t.getHours()%12;return r==="Ko"?s.ordinalNumber(a,{unit:"hour"}):w(a,r.length)},k:function(t,r,s){let a=t.getHours();return a===0&&(a=24),r==="ko"?s.ordinalNumber(a,{unit:"hour"}):w(a,r.length)},m:function(t,r,s){return r==="mo"?s.ordinalNumber(t.getMinutes(),{unit:"minute"}):T.m(t,r)},s:function(t,r,s){return r==="so"?s.ordinalNumber(t.getSeconds(),{unit:"second"}):T.s(t,r)},S:function(t,r){return T.S(t,r)},X:function(t,r,s){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(r){case"X":return me(a);case"XXXX":case"XX":return D(a);case"XXXXX":case"XXX":default:return D(a,":")}},x:function(t,r,s){const a=t.getTimezoneOffset();switch(r){case"x":return me(a);case"xxxx":case"xx":return D(a);case"xxxxx":case"xxx":default:return D(a,":")}},O:function(t,r,s){const a=t.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+ue(a,":");case"OOOO":default:return"GMT"+D(a,":")}},z:function(t,r,s){const a=t.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+ue(a,":");case"zzzz":default:return"GMT"+D(a,":")}},t:function(t,r,s){const a=Math.trunc(t.getTime()/1e3);return w(a,r.length)},T:function(t,r,s){const a=t.getTime();return w(a,r.length)}};function ue(t,r=""){const s=t>0?"-":"+",a=Math.abs(t),i=Math.trunc(a/60),n=a%60;return n===0?s+String(i):s+String(i)+r+w(n,2)}function me(t,r){return t%60===0?(t>0?"-":"+")+w(Math.abs(t)/60,2):D(t,r)}function D(t,r=""){const s=t>0?"-":"+",a=Math.abs(t),i=w(Math.trunc(a/60),2),n=w(a%60,2);return s+i+r+n}const he=(t,r)=>{switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},Se=(t,r)=>{switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},gt=(t,r)=>{const s=t.match(/(P+)(p+)?/)||[],a=s[1],i=s[2];if(!i)return he(t,r);let n;switch(a){case"P":n=r.dateTime({width:"short"});break;case"PP":n=r.dateTime({width:"medium"});break;case"PPP":n=r.dateTime({width:"long"});break;case"PPPP":default:n=r.dateTime({width:"full"});break}return n.replace("{{date}}",he(a,r)).replace("{{time}}",Se(i,r))},pt={p:Se,P:gt},wt=/^D+$/,jt=/^Y+$/,vt=["D","DD","YY","YYYY"];function bt(t){return wt.test(t)}function Nt(t){return jt.test(t)}function yt(t,r,s){const a=kt(t,r,s);if(console.warn(a),vt.includes(t))throw new RangeError(a)}function kt(t,r,s){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${r}\`) for formatting ${a} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const St=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_t=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ct=/^'([^]*?)'?$/,Ot=/''/g,Tt=/[a-zA-Z]/;function Dt(t,r,s){var o,x,p,u,b,_,g,d;const a=ne(),i=(s==null?void 0:s.locale)??a.locale??Ge,n=(s==null?void 0:s.firstWeekContainsDate)??((x=(o=s==null?void 0:s.locale)==null?void 0:o.options)==null?void 0:x.firstWeekContainsDate)??a.firstWeekContainsDate??((u=(p=a.locale)==null?void 0:p.options)==null?void 0:u.firstWeekContainsDate)??1,c=(s==null?void 0:s.weekStartsOn)??((_=(b=s==null?void 0:s.locale)==null?void 0:b.options)==null?void 0:_.weekStartsOn)??a.weekStartsOn??((d=(g=a.locale)==null?void 0:g.options)==null?void 0:d.weekStartsOn)??0,h=O(t);if(!dt(h))throw new RangeError("Invalid time value");let l=r.match(_t).map(f=>{const y=f[0];if(y==="p"||y==="P"){const S=pt[y];return S(f,i.formatLong)}return f}).join("").match(St).map(f=>{if(f==="''")return{isToken:!1,value:"'"};const y=f[0];if(y==="'")return{isToken:!1,value:qt(f)};if(de[y])return{isToken:!0,value:f};if(y.match(Tt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+y+"`");return{isToken:!1,value:f}});i.localize.preprocessor&&(l=i.localize.preprocessor(h,l));const m={firstWeekContainsDate:n,weekStartsOn:c,locale:i};return l.map(f=>{if(!f.isToken)return f.value;const y=f.value;(!(s!=null&&s.useAdditionalWeekYearTokens)&&Nt(y)||!(s!=null&&s.useAdditionalDayOfYearTokens)&&bt(y))&&yt(y,r,String(t));const S=de[y[0]];return S(h,y,i.localize,m)}).join("")}function qt(t){const r=t.match(Ct);return r?r[1].replace(Ot,"'"):t}function Pt({images:t,title:r}){const[s,a]=j.useState(0),[i,n]=j.useState(!1),[c,h]=j.useState(null),[l,m]=j.useState(null),o=t.length>0?t:["/placeholder.svg"];j.useEffect(()=>{const g=d=>{d.key==="ArrowLeft"&&p(),d.key==="ArrowRight"&&x(),d.key==="Escape"&&n(!1)};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[s]);const x=()=>{a(g=>(g+1)%o.length)},p=()=>{a(g=>(g-1+o.length)%o.length)},u=g=>{m(null),h(g.targetTouches[0].clientX)},b=g=>{m(g.targetTouches[0].clientX)},_=()=>{if(!c||!l)return;const g=c-l,d=g>50,f=g<-50;d&&o.length>1&&x(),f&&o.length>1&&p()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card rounded-xl overflow-hidden shadow-elevated",children:[e.jsxs("div",{className:"relative aspect-[16/10] bg-muted group",children:[e.jsx("img",{src:o[s],alt:`${r} - зображення ${s+1}`,className:"w-full h-full object-contain cursor-pointer",onClick:()=>n(!0),onTouchStart:u,onTouchMove:b,onTouchEnd:_}),e.jsx("button",{onClick:()=>n(!0),className:"absolute top-4 right-4 p-2 rounded-full bg-background/80 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(qe,{className:"w-5 h-5"})}),o.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:E("absolute left-4 top-1/2 -translate-y-1/2","p-3 rounded-full bg-background/80 backdrop-blur-sm","opacity-0 group-hover:opacity-100 transition-all","hover:bg-background hover:scale-110",s===0&&"hidden"),children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsx("button",{onClick:x,className:E("absolute right-4 top-1/2 -translate-y-1/2","p-3 rounded-full bg-background/80 backdrop-blur-sm","opacity-0 group-hover:opacity-100 transition-all","hover:bg-background hover:scale-110",s===o.length-1&&"hidden"),children:e.jsx(ie,{className:"w-5 h-5"})})]}),o.length>1&&e.jsxs("div",{className:"absolute bottom-4 right-4 px-3 py-1 rounded-full bg-background/80 backdrop-blur-sm text-sm",children:[s+1," / ",o.length]})]}),o.length>1&&e.jsx("div",{className:"p-4 bg-accent/5",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide",children:o.map((g,d)=>e.jsx("button",{onClick:()=>a(d),className:E("flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden","border-2 transition-all duration-200",d===s?"border-primary shadow-glow scale-105":"border-transparent hover:border-muted-foreground/50"),children:e.jsx("img",{src:g,alt:`Thumbnail ${d+1}`,className:"w-full h-full object-cover"})},d))})})]}),e.jsx(z,{open:i,onOpenChange:n,children:e.jsxs(Z,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95",children:[e.jsx("button",{onClick:()=>n(!1),className:"absolute top-4 right-4 p-2 rounded-full bg-white/10 backdrop-blur-sm text-white hover:bg-white/20 z-50",children:e.jsx(Oe,{className:"w-6 h-6"})}),e.jsxs("div",{className:"relative w-full h-[90vh] flex items-center justify-center",children:[e.jsx("img",{src:o[s],alt:`${r} - зображення ${s+1}`,className:"max-w-full max-h-full object-contain",onTouchStart:u,onTouchMove:b,onTouchEnd:_}),o.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 backdrop-blur-sm text-white hover:bg-white/20",children:e.jsx(ce,{className:"w-6 h-6"})}),e.jsx("button",{onClick:x,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/10 backdrop-blur-sm text-white hover:bg-white/20",children:e.jsx(ie,{className:"w-6 h-6"})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:o.map((g,d)=>e.jsx("button",{onClick:()=>a(d),className:E("w-2 h-2 rounded-full transition-all",d===s?"bg-white w-8":"bg-white/50")},d))})]})]})]})})]})}function Et({id:t,title:r,price:s,location:a,date:i,image:n,isPromoted:c=!1}){const h=U(),{user:l}=I(),[m,o]=j.useState(!1);j.useEffect(()=>{l&&t&&x()},[l,t]);const x=async()=>{const{data:u}=await v.from("favorites").select("id").eq("user_id",l==null?void 0:l.id).eq("listing_id",t).single();o(!!u)},p=async u=>{if(u.stopPropagation(),!l){N({title:"Потрібна авторизація",description:"Увійдіть, щоб додати до обраного",variant:"destructive"}),h("/auth");return}try{m?(await v.from("favorites").delete().eq("user_id",l.id).eq("listing_id",t),o(!1),N({title:"Видалено з обраного"})):(await v.from("favorites").insert({user_id:l.id,listing_id:t}),o(!0),N({title:"Додано до обраного"}))}catch{N({title:"Помилка",description:"Не вдалося оновити обране",variant:"destructive"})}};return e.jsxs(C,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer group",onClick:()=>h(`/listing/${t}`),children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:n,alt:r,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsx("button",{onClick:p,className:"absolute top-2 right-2 w-8 h-8 bg-white/80 backdrop-blur rounded-full flex items-center justify-center hover:bg-white transition-colors",children:e.jsx(we,{className:`w-4 h-4 ${m?"fill-red-500 text-red-500":""}`})}),c&&e.jsx("span",{className:"absolute top-2 left-2 bg-yellow-400 text-xs font-semibold px-2 py-1 rounded",children:"ТОП"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2 line-clamp-2 min-h-[48px]",children:r}),e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-xl font-bold text-primary",children:s})}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground space-x-2",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{children:a}),e.jsx("span",{children:"•"}),e.jsx("span",{children:i})]})]})]})}function Mt({className:t,...r}){return e.jsx("div",{className:E("animate-pulse rounded-md bg-muted",t),...r})}function Ft({categoryId:t,currentListingId:r,location:s}){const{data:a,isLoading:i}=M({queryKey:["similar-listings",t,r],queryFn:async()=>{let n=v.from("listings").select("*").eq("status","active").neq("id",r).limit(10);t&&(n=n.eq("category_id",t.toString()));const{data:c,error:h}=await n;if(h)throw h;return s&&c?c.sort((l,m)=>{const o=l.location===s?1:0;return(m.location===s?1:0)-o}):c||[]},enabled:!!r});return i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:"Схожі оголошення"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((n,c)=>e.jsx(Mt,{className:"h-64 rounded-lg"},c))})]}):!a||a.length===0?null:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:"Схожі оголошення"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.length," оголошень"]})]}),e.jsxs(Pe,{opts:{align:"start",loop:!1},className:"w-full",children:[e.jsx(Ee,{className:"-ml-2 md:-ml-4",children:a.map(n=>{var c;return e.jsx(Me,{className:"pl-2 md:pl-4 basis-full sm:basis-1/2 lg:basis-1/3 xl:basis-1/4",children:e.jsx(Et,{id:n.id,title:n.title,price:n.price?`${n.price.toLocaleString("uk-UA")} ${n.currency}`:"Безкоштовно",location:n.location,date:new Date(n.created_at).toLocaleDateString("uk-UA"),image:((c=n.images)==null?void 0:c[0])||"/placeholder.svg",isPromoted:n.is_promoted})},n.id)})}),e.jsx(Fe,{className:"hidden md:flex -left-12 hover:shadow-glow"}),e.jsx(Ye,{className:"hidden md:flex -right-12 hover:shadow-glow"})]})]})}function Yt({listingId:t}){const{user:r}=I(),s=V(),[a,i]=j.useState(5),[n,c]=j.useState(""),[h,l]=j.useState(!1),{data:m,isLoading:o}=M({queryKey:["reviews",t],queryFn:async()=>{const{data:u,error:b}=await v.from("reviews").select("*").eq("listing_id",t).order("created_at",{ascending:!1});if(b)throw b;return await Promise.all((u||[]).map(async g=>{const{data:d}=await v.from("profiles").select("username, full_name, avatar_url").eq("id",g.user_id).maybeSingle();return{...g,profiles:d}}))}}),x=W({mutationFn:async()=>{if(!r)throw new Error("Потрібна авторизація");const{error:u}=await v.from("reviews").insert({listing_id:t,user_id:r.id,rating:a,comment:n.trim()||null});if(u)throw u},onSuccess:()=>{s.invalidateQueries({queryKey:["reviews",t]}),c(""),i(5),l(!1),N({title:"Відгук додано",description:"Дякуємо за ваш відгук!"})},onError:()=>{N({title:"Помилка",description:"Не вдалося додати відгук",variant:"destructive"})}}),p=m!=null&&m.length?m.reduce((u,b)=>u+b.rating,0)/m.length:0;return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),"Відгуки та оцінки"]}),m&&m.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((u,b)=>e.jsx(X,{className:`w-4 h-4 ${b<Math.round(p)?"fill-warning text-warning":"text-muted-foreground"}`},b))}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p.toFixed(1)," (",m.length," відгуків)"]})]})]}),r&&!h&&e.jsx(k,{onClick:()=>l(!0),variant:"outline",children:"Залишити відгук"})]}),h&&e.jsxs("div",{className:"mb-6 p-4 bg-accent/10 rounded-lg space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Ваша оцінка"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(u=>e.jsx("button",{onClick:()=>i(u),className:"p-1 hover:scale-110 transition-transform",children:e.jsx(X,{className:`w-6 h-6 ${u<=a?"fill-warning text-warning":"text-muted-foreground hover:text-warning"}`})},u))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Коментар (необов'язково)"}),e.jsx(L,{value:n,onChange:u=>c(u.target.value),placeholder:"Поділіться вашим досвідом...",rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{onClick:()=>x.mutate(),disabled:x.isPending,children:"Опублікувати відгук"}),e.jsx(k,{variant:"outline",onClick:()=>{l(!1),c(""),i(5)},children:"Скасувати"})]})]}),e.jsx("div",{className:"space-y-4",children:o?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Завантаження відгуків..."}):m&&m.length>0?m.map(u=>{var b,_,g;return e.jsx("div",{className:"border-b last:border-0 pb-4 last:pb-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(ee,{className:"w-10 h-10",children:[e.jsx(te,{src:((b=u.profiles)==null?void 0:b.avatar_url)||void 0}),e.jsx(se,{children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium",children:((_=u.profiles)==null?void 0:_.full_name)||((g=u.profiles)==null?void 0:g.username)||"Користувач"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:H(new Date(u.created_at),{addSuffix:!0,locale:F})})]}),e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((d,f)=>e.jsx(X,{className:`w-3 h-3 ${f<u.rating?"fill-warning text-warning":"text-muted-foreground"}`},f))}),u.comment&&e.jsx("p",{className:"text-muted-foreground mt-2",children:u.comment})]})]})},u.id)}):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Поки що немає відгуків. Будьте першим!"})})]})}function Wt({listingId:t,sellerId:r}){const{user:s}=I(),a=V(),[i,n]=j.useState(""),[c,h]=j.useState(""),[l,m]=j.useState(null),[o,x]=j.useState(!1),{data:p,isLoading:u}=M({queryKey:["questions",t],queryFn:async()=>{const{data:d,error:f}=await v.from("questions").select("*").eq("listing_id",t).order("created_at",{ascending:!1});if(f)throw f;return await Promise.all((d||[]).map(async S=>{const{data:Y}=await v.from("profiles").select("username, full_name, avatar_url").eq("id",S.user_id).maybeSingle(),{data:A}=S.answered_by?await v.from("profiles").select("username, full_name, avatar_url").eq("id",S.answered_by).maybeSingle():{data:null};return{...S,user_profiles:Y,answerer_profiles:A}}))}}),b=W({mutationFn:async()=>{if(!s)throw new Error("Потрібна авторизація");const{error:d}=await v.from("questions").insert({listing_id:t,user_id:s.id,question:i.trim()});if(d)throw d},onSuccess:()=>{a.invalidateQueries({queryKey:["questions",t]}),n(""),x(!1),N({title:"Питання додано",description:"Продавець отримає повідомлення про ваше питання"})},onError:()=>{N({title:"Помилка",description:"Не вдалося додати питання",variant:"destructive"})}}),_=W({mutationFn:async d=>{if(!s)throw new Error("Потрібна авторизація");const{error:f}=await v.from("questions").update({answer:c.trim(),answered_by:s.id,answered_at:new Date().toISOString()}).eq("id",d);if(f)throw f},onSuccess:()=>{a.invalidateQueries({queryKey:["questions",t]}),h(""),m(null),N({title:"Відповідь додано"})},onError:()=>{N({title:"Помилка",description:"Не вдалося додати відповідь",variant:"destructive"})}}),g=(s==null?void 0:s.id)===r;return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-primary"}),"Питання та відповіді"]}),s&&!g&&!o&&e.jsx(k,{onClick:()=>x(!0),variant:"outline",children:"Задати питання"})]}),o&&e.jsxs("div",{className:"mb-6 p-4 bg-accent/10 rounded-lg space-y-4",children:[e.jsx(L,{value:i,onChange:d=>n(d.target.value),placeholder:"Введіть ваше питання...",rows:3}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{onClick:()=>b.mutate(),disabled:!i.trim()||b.isPending,children:"Надіслати питання"}),e.jsx(k,{variant:"outline",onClick:()=>{x(!1),n("")},children:"Скасувати"})]})]}),e.jsx("div",{className:"space-y-4",children:u?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Завантаження питань..."}):p&&p.length>0?p.map(d=>{var f,y,S;return e.jsxs("div",{className:"border-b last:border-0 pb-4 last:pb-0 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(ee,{className:"w-8 h-8",children:[e.jsx(te,{src:((f=d.user_profiles)==null?void 0:f.avatar_url)||void 0}),e.jsx(se,{children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"text-sm font-medium",children:((y=d.user_profiles)==null?void 0:y.full_name)||((S=d.user_profiles)==null?void 0:S.username)||"Користувач"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:H(new Date(d.created_at),{addSuffix:!0,locale:F})})]}),e.jsx("p",{className:"text-foreground",children:d.question})]})]}),d.answer&&e.jsx("div",{className:"ml-11 p-3 bg-primary/5 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Xe,{className:"w-4 h-4 text-primary mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-primary",children:"Відповідь продавця"}),d.answered_at&&e.jsx("span",{className:"text-xs text-muted-foreground",children:H(new Date(d.answered_at),{addSuffix:!0,locale:F})})]}),e.jsx("p",{className:"text-sm",children:d.answer})]})]})}),g&&!d.answer&&l!==d.id&&e.jsx("div",{className:"ml-11",children:e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>m(d.id),children:[e.jsx(Le,{className:"w-3 h-3 mr-2"}),"Відповісти"]})}),l===d.id&&e.jsxs("div",{className:"ml-11 p-3 bg-accent/10 rounded-lg space-y-3",children:[e.jsx(L,{value:c,onChange:Y=>h(Y.target.value),placeholder:"Введіть вашу відповідь...",rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{size:"sm",onClick:()=>_.mutate(d.id),disabled:!c.trim()||_.isPending,children:"Надіслати"}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{m(null),h("")},children:"Скасувати"})]})]})]},d.id)}):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Поки що немає питань. Будьте першим!"})})]})}function Lt({listing:t,isFavorite:r,onToggleFavorite:s,onContact:a,onShare:i}){return e.jsxs(C,{className:"p-6 space-y-4",children:[t.is_promoted&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-warning/20 to-warning/10 text-warning text-sm font-medium",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Промо оголошення"]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:t.title}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.categories&&e.jsxs(ve,{variant:"secondary",className:"gap-1",children:[e.jsx(Ue,{className:"w-3 h-3"}),t.categories.name_uk]})})]}),e.jsx("div",{className:"text-right",children:t.price?e.jsx("div",{children:e.jsxs("div",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:[t.price.toLocaleString("uk-UA")," ",t.currency]})}):e.jsx("div",{className:"text-2xl font-semibold text-muted-foreground",children:"Безкоштовно"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(J,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:t.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ve,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:H(new Date(t.created_at),{addSuffix:!0,locale:F})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(be,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:[t.views," переглядів"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4 border-t",children:[e.jsxs(k,{onClick:a,size:"lg",className:"flex-1 min-w-[200px] bg-gradient-to-r from-primary to-primary-glow hover:shadow-glow transition-all duration-300",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"Написати повідомлення"]}),e.jsxs(k,{onClick:s,variant:r?"default":"outline",size:"lg",className:`px-6 transition-all duration-300 ${r?"bg-red-500 hover:bg-red-600 text-white shadow-glow":"hover:border-red-500 hover:text-red-500 hover:shadow-sm"}`,children:[e.jsx(we,{className:`w-5 h-5 transition-transform ${r?"fill-current scale-110":""}`}),e.jsx("span",{className:"sr-only ml-2 hidden sm:inline",children:r?"Видалити з обраного":"Додати до обраного"})]}),e.jsxs(k,{onClick:i,variant:"outline",size:"lg",className:"px-6 hover:border-blue-500 hover:text-blue-500 hover:shadow-sm transition-all duration-300",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{className:"sr-only ml-2 hidden sm:inline",children:"Поділитися"})]})]})]})}function $t({description:t}){return t?e.jsxs(C,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-primary"}),"Опис товару"]}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap leading-relaxed",children:t})]}):null}const Ht=[{value:"spam",label:"Спам або реклама"},{value:"fraud",label:"Шахрайство"},{value:"inappropriate",label:"Неприйнятний вміст"},{value:"wrong_category",label:"Неправильна категорія"},{value:"sold",label:"Товар вже продано"},{value:"other",label:"Інша причина"}];function It({listingId:t}){const{user:r}=I(),[s,a]=j.useState(!1),[i,n]=j.useState(""),[c,h]=j.useState(""),l=W({mutationFn:async()=>{if(!r)throw new Error("Потрібна авторизація");const{error:o}=await v.from("reports").insert({listing_id:t,user_id:r.id,reason:i,description:c.trim()||null});if(o)throw o},onSuccess:()=>{a(!1),n(""),h(""),N({title:"Скаргу надіслано",description:"Дякуємо! Ми розглянемо вашу скаргу найближчим часом."})},onError:()=>{N({title:"Помилка",description:"Не вдалося надіслати скаргу",variant:"destructive"})}}),m=()=>{if(!r){N({title:"Потрібна авторизація",description:"Увійдіть, щоб поскаржитися на оголошення",variant:"destructive"});return}if(!i){N({title:"Оберіть причину",description:"Будь ласка, вкажіть причину скарги",variant:"destructive"});return}l.mutate()};return e.jsxs(z,{open:s,onOpenChange:a,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(k,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),"Поскаржитися"]})}),e.jsxs(Z,{className:"sm:max-w-[425px]",children:[e.jsxs(xe,{children:[e.jsx(ge,{children:"Поскаржитися на оголошення"}),e.jsx(pe,{children:"Якщо це оголошення порушує правила сайту, повідомте нам про це."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Причина скарги"}),e.jsxs(ze,{value:i,onValueChange:n,children:[e.jsx(Ze,{children:e.jsx(Je,{placeholder:"Оберіть причину"})}),e.jsx(et,{children:Ht.map(o=>e.jsx(tt,{value:o.value,children:o.label},o.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"description",children:"Додаткова інформація (необов'язково)"}),e.jsx(L,{id:"description",value:c,onChange:o=>h(o.target.value),placeholder:"Опишіть проблему детальніше...",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>a(!1),children:"Скасувати"}),e.jsx(k,{onClick:m,disabled:!i||l.isPending,children:"Надіслати скаргу"})]})]})]})}function Rt({listing:t}){return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Додаткова інформація"}),e.jsx(It,{listingId:t.id})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"ID оголошення:"}),e.jsx("p",{className:"font-medium",children:t.id.slice(0,8).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Статус:"}),e.jsx("p",{className:"font-medium",children:t.status==="active"?"Активне":"Неактивне"})]})]})]})}function Qt({userId:t,onContact:r}){const s=U(),[a,i]=j.useState(null),[n,c]=j.useState(0),[h,l]=j.useState(0),[m,o]=j.useState(!1),[x,p]=j.useState(!1),[u,b]=j.useState(0);j.useEffect(()=>{_()},[t]);const _=async()=>{try{const{data:f}=await v.from("profiles").select("*").eq("id",t).single();i(f),p((f==null?void 0:f.account_type)==="business"),o((f==null?void 0:f.is_verified)||!1);const{count:y}=await v.from("listings").select("*",{count:"exact",head:!0}).eq("user_id",t).eq("status","active");c(y||0);const{data:S,error:Y}=await v.from("user_ratings").select("rating").eq("rated_user_id",t);if(!Y&&S.length>0){const A=S.reduce((_e,Ce)=>_e+Ce.rating,0)/S.length;l(Number(A.toFixed(1))),b(S.length)}}catch(f){console.error("Error fetching seller data:",f)}},g=f=>f?f.split(" ").map(y=>y[0]).join("").toUpperCase():"К",d=a!=null&&a.created_at?H(new Date(a.created_at),{addSuffix:!1,locale:F}):"Нещодавно";return e.jsxs(C,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-primary"}),"Продавець"]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(ee,{className:"w-16 h-16 border-2 border-primary/20",children:[e.jsx(te,{src:a==null?void 0:a.avatar_url}),e.jsx(se,{className:"bg-gradient-to-br from-primary/20 to-primary/10 text-lg font-semibold",children:g(a==null?void 0:a.full_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("h4",{className:"font-semibold text-lg",children:(a==null?void 0:a.full_name)||"Користувач"})}),e.jsx(Ie,{isBusiness:x,isVerified:m,rating:h,size:"md"}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mt-2",children:e.jsxs("span",{children:[u," відгуків"]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"На Novado"})]}),e.jsx("p",{className:"font-medium",children:d})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Оголошень"})]}),e.jsx("p",{className:"font-medium",children:n})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-accent/50",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"font-medium",children:"Зазвичай відповідає протягом години"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(k,{onClick:r,className:"w-full",size:"lg",children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"Написати продавцю"]}),e.jsxs(k,{onClick:()=>s(`/profile/${t}`),variant:"outline",className:"w-full",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Всі оголошення автора"]})]})]})}function At({listingId:t,currentPrice:r,currency:s}){const{data:a}=M({queryKey:["price-history",t],queryFn:async()=>{const{data:i,error:n}=await v.from("price_history").select("*").eq("listing_id",t).order("changed_at",{ascending:!1}).limit(5);if(n)throw n;return i}});return!a||a.length===0?null:e.jsxs(C,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Історія зміни ціни"}),e.jsxs("div",{className:"space-y-2",children:[r&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-primary/5 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Поточна ціна"}),e.jsxs("span",{className:"font-semibold text-primary",children:[r.toLocaleString("uk-UA")," ",s]})]}),a.map((i,n)=>{var l,m;const c=i.new_price&&i.old_price?i.new_price-i.old_price:0,h=i.old_price?c/i.old_price*100:0;return e.jsxs("div",{className:"flex items-center justify-between py-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c>0?e.jsx(at,{className:"w-4 h-4 text-destructive"}):c<0?e.jsx(Re,{className:"w-4 h-4 text-success"}):e.jsx(Qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[(l=i.old_price)==null?void 0:l.toLocaleString("uk-UA")," → ",(m=i.new_price)==null?void 0:m.toLocaleString("uk-UA")," ",s]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Dt(new Date(i.changed_at),"d MMM yyyy",{locale:F})})]})]}),h!==0&&e.jsxs("span",{className:`text-xs font-medium ${c>0?"text-destructive":"text-success"}`,children:[c>0?"+":"",h.toFixed(1),"%"]})]},i.id)})]})]})}function Bt(){const t=[{icon:Ne,text:"Ніколи не надсилайте передоплату без гарантій",level:"critical"},{icon:J,text:"Зустрічайтеся у безпечних публічних місцях",level:"warning"},{icon:be,text:"Ретельно перевіряйте товар перед покупкою",level:"info"},{icon:K,text:"Користуйтеся безпечними способами оплати",level:"info"}],r=s=>{switch(s){case"critical":return"text-red-600 dark:text-red-400";case"warning":return"text-warning";case"info":return"text-primary";default:return"text-muted-foreground"}};return e.jsx(C,{className:"p-6 bg-gradient-to-br from-warning/10 via-background to-red-500/5 border-warning/30 shadow-elevated hover:shadow-glow transition-all duration-300",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-warning/20",children:e.jsx(nt,{className:"w-5 h-5 text-warning"})}),e.jsx("h4",{className:"font-semibold text-lg",children:"Правила безпеки Novado"})]}),e.jsx("div",{className:"grid gap-3",children:t.map((s,a)=>{const i=s.icon;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-background/50 hover:bg-background/80 transition-colors duration-200",children:[e.jsx("div",{className:E("p-1.5 rounded-full flex-shrink-0",s.level==="critical"&&"bg-red-100 dark:bg-red-900/30",s.level==="warning"&&"bg-warning/20",s.level==="info"&&"bg-primary/20"),children:e.jsx(i,{className:`w-4 h-4 ${r(s.level)}`})}),e.jsx("span",{className:"leading-relaxed text-sm font-medium",children:s.text})]},a)})}),e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200/50 dark:border-blue-800/50",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("strong",{children:"Пам'ятайте:"})," Novado не несе відповідальності за угоди між користувачами"]})})]})})}const Gt=()=>{const t=V();return W({mutationFn:async({listingId:r,sellerId:s,offeredPrice:a,message:i,expiresAt:n})=>{const{data:{user:c}}=await v.auth.getUser();if(!c)throw new Error("Not authenticated");const{data:h,error:l}=await v.from("price_offers").insert({listing_id:r,seller_id:s,buyer_id:c.id,offered_price:a,message:i,expires_at:n}).select().single();if(l)throw l;return h},onSuccess:(r,s)=>{t.invalidateQueries({queryKey:["price-offers",s.listingId]}),t.invalidateQueries({queryKey:["price-offers"]})}})};function Xt({listingId:t,sellerId:r,currentPrice:s,currency:a,listingTitle:i}){const[n,c]=j.useState(!1),[h,l]=j.useState(s?Math.floor(s*.8):0),[m,o]=j.useState(""),x=Gt(),p=async u=>{if(u.preventDefault(),!h||h<=0){N({title:"Помилка",description:"Введіть коректну ціну",variant:"destructive"});return}try{await x.mutateAsync({listingId:t,sellerId:r,offeredPrice:h,message:m||void 0}),N({title:"Пропозицію надіслано",description:"Продавець отримає ваше повідомлення і зможе прийняти або відхилити пропозицію"}),c(!1),l(s?Math.floor(s*.8):0),o("")}catch{N({title:"Помилка",description:"Не вдалося надіслати пропозицію",variant:"destructive"})}};return e.jsxs(z,{open:n,onOpenChange:c,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(k,{className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-glow hover:shadow-elevated transition-all duration-300",size:"lg",children:[e.jsx(Ne,{className:"w-5 h-5 mr-2"}),"Запропонувати ціну"]})}),e.jsxs(Z,{className:"sm:max-w-md",children:[e.jsxs(xe,{children:[e.jsx(ge,{children:"Запропонувати ціну"}),e.jsx(pe,{children:"Надішліть свою пропозицію продавцю"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted",children:[e.jsx("p",{className:"font-medium text-sm",children:i}),s&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Поточна ціна:"}),e.jsxs(ve,{variant:"secondary",children:[s.toLocaleString()," ",a]})]})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"price",children:"Ваша пропозиція"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(it,{id:"price",type:"number",value:h,onChange:u=>l(Number(u.target.value)),placeholder:"0",min:"1",required:!0}),e.jsx("div",{className:"flex items-center px-3 border rounded-md bg-muted text-muted-foreground",children:a})]})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"message",children:"Повідомлення (необов'язково)"}),e.jsx(L,{id:"message",value:m,onChange:u=>o(u.target.value),placeholder:"Додайте коментар до вашої пропозиції...",rows:3})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>c(!1),className:"flex-1",children:"Скасувати"}),e.jsx(k,{type:"submit",disabled:x.isPending,className:"flex-1",children:x.isPending?"Відправка...":"Надіслати"})]})]})]})]})]})}function Kt({listing:t,user:r,onContact:s}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qt,{userId:t.user_id,onContact:s}),t.price&&t.user_id!==(r==null?void 0:r.id)&&e.jsx(C,{className:"p-4",children:e.jsx(Xt,{listingId:t.id,currentPrice:t.price,sellerId:t.user_id,listingTitle:t.title,currency:t.currency})}),e.jsx(At,{listingId:t.id,currentPrice:t.price,currency:t.currency}),e.jsx(Bt,{})]})}function Es(){const{id:t}=Te(),r=U(),{user:s}=I();j.useState(0);const[a,i]=j.useState(!1),{data:n,isLoading:c}=M({queryKey:["listing",t],queryFn:async()=>{const{data:x,error:p}=await v.from("listings").select(`
          *,
          categories:category_id (
            name,
            name_uk
          )
        `).eq("id",t).single();if(p)throw p;return sessionStorage.getItem(`viewed-${t}`)||(await v.from("listings").update({views:(x.views||0)+1}).eq("id",t),sessionStorage.setItem(`viewed-${t}`,"true")),x}});M({queryKey:["favorites",t,s==null?void 0:s.id],queryFn:async()=>{if(!s)return[];const{data:x,error:p}=await v.from("favorites").select("*").eq("user_id",s.id).eq("listing_id",t);if(p)throw p;return i(x.length>0),x},enabled:!!s&&!!t});const h=async()=>{if(!s){N({title:"Потрібна авторизація",description:"Увійдіть, щоб додати до обраного",variant:"destructive"});return}try{a?(await v.from("favorites").delete().eq("user_id",s.id).eq("listing_id",t),i(!1),N({title:"Видалено з обраного"})):(await v.from("favorites").insert({user_id:s.id,listing_id:t}),i(!0),N({title:"Додано до обраного"}))}catch{N({title:"Помилка",description:"Не вдалося оновити обране",variant:"destructive"})}},l=async()=>{if(!s){N({title:"Потрібна авторизація",description:"Увійдіть, щоб зв'язатися з продавцем",variant:"destructive"}),r("/auth");return}try{await v.from("messages").insert({sender_id:s.id,receiver_id:n==null?void 0:n.user_id,content:`Вітаю! Мене цікавить ваше оголошення "${n==null?void 0:n.title}"`,listing_id:t}),r(`/messages/${n==null?void 0:n.user_id}`)}catch{r(`/messages/${n==null?void 0:n.user_id}`)}},m=()=>{var x;(x=navigator.share)==null||x.call(navigator,{title:n==null?void 0:n.title,text:(n==null?void 0:n.description)||"",url:window.location.href}).catch(()=>{navigator.clipboard.writeText(window.location.href),N({title:"Посилання скопійовано",description:"Ви можете поділитися ним з друзями"})})};if(c)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-96 bg-muted rounded-lg mb-6"}),e.jsx("div",{className:"h-8 bg-muted rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/4"})]})}),e.jsx(G,{})]});if(!n)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(De,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Оголошення не знайдено"}),e.jsx(k,{onClick:()=>r("/"),children:"Повернутися на головну"})]})}),e.jsx(G,{})]});const o=n.images||["/placeholder.svg"];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-accent/5",children:[e.jsx(B,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-6",children:[e.jsx("button",{onClick:()=>r("/"),className:"hover:text-primary transition-colors",children:"Головна"}),e.jsx("span",{children:"/"}),n.categories&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(`/category/${n.categories.name_uk.toLowerCase()}`),className:"hover:text-primary transition-colors",children:n.categories.name_uk}),e.jsx("span",{children:"/"})]}),e.jsx("span",{className:"text-foreground",children:n.title})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(Pt,{images:o,title:n.title}),e.jsx(Lt,{listing:n,isFavorite:a,onToggleFavorite:h,onContact:l,onShare:m}),e.jsx($t,{description:n.description}),e.jsx(Rt,{listing:n}),e.jsx(Yt,{listingId:n.id}),e.jsx(Wt,{listingId:n.id,sellerId:n.user_id})]}),e.jsx(Kt,{listing:n,user:s,onContact:l})]}),e.jsx("div",{className:"mt-12",children:e.jsx(Ft,{categoryId:n.category_id?parseInt(n.category_id):void 0,currentListingId:n.id,location:n.location})})]}),e.jsx(G,{})]})}export{Es as default};
