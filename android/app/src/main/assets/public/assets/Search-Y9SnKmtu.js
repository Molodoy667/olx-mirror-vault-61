import{x as B,u as R,r as l,j as e,B as x,s as $}from"./index-KbJkRX07.js";import{u as E}from"./useQuery-DYBXd3SC.js";import{H as L,b as V}from"./Footer-CG381HwE.js";import{M as I}from"./MobileNav-iDjdoy_U.js";import{P as z}from"./ProductCardNew-DTAZEOFN.js";import{I as k}from"./input-BfmWFPkP.js";import{S as w,d as P,e as C,f as _,g as n}from"./select-CxSQralT.js";import{a as A,S as D}from"./separator-D_BKHY2d.js";import{a as H}from"./useCategories-C6twurrF.js";import{S as K}from"./SaveSearchDialog-a3qxPSbS.js";import{S as M}from"./search-B1u6Ento.js";import{F as Q}from"./filter-LTiH40-A.js";import"./useAdmin-wN6CKAL8.js";import"./Combination-CN-dILO0.js";import"./badge-DpjjU75J.js";import"./index-D5jjwgwZ.js";import"./index-ohYBQjSJ.js";import"./globe-BvyP_gKp.js";import"./uk-Drv84rxe.js";import"./star-B840Te7u.js";import"./eye-jg7wg44x.js";import"./heart-BstkNJZ-.js";import"./avatar-CGybcn-y.js";import"./user-Dt39FPRe.js";import"./plus-D5zmitre.js";import"./useMutation-BJki3aSv.js";import"./map-pin-0eGOnbmD.js";import"./label-CwWGJCIM.js";import"./switch-RRtVucGl.js";import"./dialog-C3rICmIe.js";import"./index-CAsdkEwS.js";import"./save-CCtX2FOD.js";import"./bell-off-DNtwkVSf.js";import"./dollar-sign--DFDUvgJ.js";function we(){const[c,p]=B();R();const{data:u}=H(),[r,g]=l.useState(c.get("q")||""),[t,j]=l.useState(c.get("category")||"all"),[i,f]=l.useState(c.get("location")||""),[a,v]=l.useState([Number(c.get("minPrice"))||0,Number(c.get("maxPrice"))||1e5]),[o,b]=l.useState(c.get("sort")||"date"),[N,q]=l.useState(!1),{data:d,isLoading:F}=E({queryKey:["search",r,t,i,a,o],queryFn:async()=>{let s=$.from("listings").select(`
          *,
          categories (
            name,
            name_uk
          )
        `).eq("status","active");switch(r&&(s=s.or(`title.ilike.%${r}%,description.ilike.%${r}%`)),t&&t!=="all"&&(s=s.eq("category_id",t)),i&&(s=s.ilike("location",`%${i}%`)),a[0]>0&&(s=s.gte("price",a[0])),a[1]<1e5&&(s=s.lte("price",a[1])),o){case"price_asc":s=s.order("price",{ascending:!0,nullsFirst:!1});break;case"price_desc":s=s.order("price",{ascending:!1,nullsFirst:!1});break;case"date":default:s=s.order("is_promoted",{ascending:!1}).order("created_at",{ascending:!1});break}const{data:m,error:S}=await s;if(S)throw S;return m}}),h=()=>{const s=new URLSearchParams;r&&s.set("q",r),t&&t!=="all"&&s.set("category",t),i&&s.set("location",i),a[0]>0&&s.set("minPrice",a[0].toString()),a[1]<1e5&&s.set("maxPrice",a[1].toString()),o!=="date"&&s.set("sort",o),p(s)},y=()=>{g(""),j("all"),f(""),v([0,1e5]),b("date"),p(new URLSearchParams)};return l.useEffect(()=>{h()},[o]),e.jsxs("div",{className:"min-h-screen bg-background pb-20 md:pb-0",children:[e.jsx(L,{}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:`lg:w-64 ${N?"block":"hidden lg:block"}`,children:e.jsxs("div",{className:"bg-card rounded-lg p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Фільтри"}),e.jsx(x,{onClick:y,variant:"ghost",size:"sm",children:"Очистити"})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Пошук"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{placeholder:"Що шукаєте?",value:r,onChange:s=>g(s.target.value),onKeyDown:s=>s.key==="Enter"&&h()}),e.jsx(M,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Категорія"}),e.jsxs(w,{value:t,onValueChange:j,children:[e.jsx(P,{children:e.jsx(C,{placeholder:"Всі категорії"})}),e.jsxs(_,{children:[e.jsx(n,{value:"all",children:"Всі категорії"}),u==null?void 0:u.map(s=>e.jsx(n,{value:s.id,children:s.name_uk},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Місцезнаходження"}),e.jsx(k,{placeholder:"Місто або область",value:i,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Ціна: ",a[0]," - ",a[1]," грн"]}),e.jsx(D,{value:a,onValueChange:s=>v(s),max:1e5,step:100,className:"mt-3"})]}),e.jsx(x,{onClick:h,className:"w-full",children:"Застосувати фільтри"})]})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-card rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:r?`Результати пошуку: "${r}"`:"Всі оголошення"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Знайдено ",(d==null?void 0:d.length)||0," оголошень"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{filters:{query:r||void 0,category:t==="all"?void 0:t,location:i||void 0,minPrice:a[0]>0?a[0]:void 0,maxPrice:a[1]<1e5?a[1]:void 0,onlyWithPhoto:!1,onlyPromoted:!1}}),e.jsxs(x,{onClick:()=>q(!N),variant:"outline",size:"sm",className:"lg:hidden",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Фільтри"]}),e.jsxs(w,{value:o,onValueChange:b,children:[e.jsx(P,{className:"w-40",children:e.jsx(C,{})}),e.jsxs(_,{children:[e.jsx(n,{value:"date",children:"Найновіші"}),e.jsx(n,{value:"price_asc",children:"Дешевші"}),e.jsx(n,{value:"price_desc",children:"Дорожчі"})]})]})]})]})}),F?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((s,m)=>e.jsxs("div",{className:"bg-card rounded-lg p-4 animate-pulse",children:[e.jsx("div",{className:"aspect-square bg-muted rounded-lg mb-3"}),e.jsx("div",{className:"h-4 bg-muted rounded mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]},m))}):d&&d.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:d.map(s=>{var m;return e.jsx(z,{id:s.id,title:s.title,price:s.price||0,currency:s.currency,location:s.location,image:((m=s.images)==null?void 0:m[0])||"/placeholder.svg",isPromoted:s.is_promoted,createdAt:s.created_at},s.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"Нічого не знайдено"}),e.jsx(x,{onClick:y,variant:"link",className:"mt-2",children:"Очистити фільтри"})]})]})]})}),e.jsx(V,{}),e.jsx(I,{})]})}export{we as default};
