import{r as y,h as T,v as k,s as x,j as e,B as p,k as w,t as _,w as D,u as B}from"./index-KbJkRX07.js";import{u as g}from"./useQuery-DYBXd3SC.js";import{H as K,b as A}from"./Footer-CG381HwE.js";import{P as q}from"./ProductCardNew-DTAZEOFN.js";import{T as H,a as E,b as C,c as S}from"./tabs-Bq0uXDOJ.js";import{u as I}from"./useAdmin-wN6CKAL8.js";import{u as U}from"./useMutation-BJki3aSv.js";import{D as L,a as M,b as O,c as Q,d as V,e as z}from"./dialog-C3rICmIe.js";import{I as v}from"./input-BfmWFPkP.js";import{L as h}from"./label-CwWGJCIM.js";import{T as R}from"./textarea-dp5bmWKD.js";import{S as X,d as Y,e as $,f as G,g as u}from"./select-CxSQralT.js";import{B as f}from"./badge-DpjjU75J.js";import{C as J}from"./crown-DLJ2ViQA.js";import{B as W,S as Z}from"./settings-DWrH-Tg4.js";import{C as ee}from"./circle-x-CEBvVcIA.js";import{C as se}from"./circle-check-big-HnBDMycv.js";import{C as re}from"./clock-DUppK43j.js";import{U as ae}from"./user-Dt39FPRe.js";import{M as te}from"./map-pin-0eGOnbmD.js";import{C as ie}from"./calendar-CuXXWuSH.js";import{P as N,S as le}from"./Combination-CN-dILO0.js";import{H as F}from"./heart-BstkNJZ-.js";import"./index-D5jjwgwZ.js";import"./index-ohYBQjSJ.js";import"./globe-BvyP_gKp.js";import"./uk-Drv84rxe.js";import"./star-B840Te7u.js";import"./eye-jg7wg44x.js";import"./avatar-CGybcn-y.js";import"./search-B1u6Ento.js";import"./plus-D5zmitre.js";import"./index-CAsdkEwS.js";function ne(){const[c,m]=y.useState(!1),[j,d]=y.useState(""),{user:n}=T(),a=k(),{data:i}=g({queryKey:["business-tariffs"],queryFn:async()=>{const{data:r,error:o}=await x.from("tariff_plans").select("*").eq("type","business_account").eq("is_active",!0).order("price");if(o)throw o;return r}}),{data:l}=g({queryKey:["user-verification-request",n==null?void 0:n.id],queryFn:async()=>{if(!n)return null;const{data:r,error:o}=await x.from("business_verification_requests").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(o)throw o;return r},enabled:!!n}),s=U({mutationFn:async r=>{if(!n)throw new Error("User not authenticated");const o={user_id:n.id,business_name:r.get("business_name"),business_type:r.get("business_type"),tax_id:r.get("tax_id"),website:r.get("website"),description:r.get("description")},{error:b}=await x.from("business_verification_requests").insert(o);if(b)throw b},onSuccess:()=>{a.invalidateQueries({queryKey:["user-verification-request"]}),_({title:"Заявку надіслано",description:"Ваша заявка на верифікацію бізнес-акаунту надіслана на розгляд"}),m(!1)},onError:()=>{_({title:"Помилка",description:"Не вдалося надіслати заявку",variant:"destructive"})}}),t=r=>{r.preventDefault();const o=new FormData(r.currentTarget);s.mutate(o)},P=r=>{switch(r){case"pending":return e.jsxs(f,{variant:"secondary",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Очікує розгляду"]});case"approved":return e.jsxs(f,{variant:"default",className:"bg-green-600",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Схвалено"]});case"rejected":return e.jsxs(f,{variant:"destructive",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Відхилено"]});default:return e.jsx(f,{variant:"outline",children:r})}};return e.jsxs(L,{open:c,onOpenChange:m,children:[e.jsx(M,{asChild:!0,children:e.jsxs(p,{className:"w-full bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white shadow-glow",children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"Перейти на бізнес тариф"]})}),e.jsxs(O,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Q,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-6 h-6 text-primary"}),"Перехід на бізнес-акаунт"]}),e.jsx(z,{children:"Отримайте додаткові можливості для розвитку вашого бізнесу"})]}),e.jsxs("div",{className:"space-y-6",children:[l&&e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Статус верифікації"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Заявка "',l.business_name,'"']})]}),P(l.status)]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Бізнес тарифи"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:i==null?void 0:i.map(r=>e.jsx(w,{className:`p-4 cursor-pointer transition-colors ${j===r.id?"ring-2 ring-primary":""}`,onClick:()=>d(r.id),children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:r.name}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[r.price," ",r.currency]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["на ",r.duration_days," днів"]}),e.jsx("p",{className:"text-xs",children:r.description})]})},r.id))})]}),(!l||l.status==="rejected")&&e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Заявка на верифікацію"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"business_name",children:"Назва бізнесу *"}),e.jsx(v,{id:"business_name",name:"business_name",required:!0,placeholder:"ТОВ Моя Компанія"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"business_type",children:"Тип бізнесу"}),e.jsxs(X,{name:"business_type",children:[e.jsx(Y,{children:e.jsx($,{placeholder:"Оберіть тип"})}),e.jsxs(G,{children:[e.jsx(u,{value:"retail",children:"Роздрібна торгівля"}),e.jsx(u,{value:"services",children:"Послуги"}),e.jsx(u,{value:"manufacturing",children:"Виробництво"}),e.jsx(u,{value:"it",children:"IT та технології"}),e.jsx(u,{value:"real_estate",children:"Нерухомість"}),e.jsx(u,{value:"other",children:"Інше"})]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"tax_id",children:"Податковий номер *"}),e.jsx(v,{id:"tax_id",name:"tax_id",required:!0,placeholder:"12345678"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"website",children:"Веб-сайт"}),e.jsx(v,{id:"website",name:"website",type:"url",placeholder:"https://example.com"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"Опис бізнесу"}),e.jsx(R,{id:"description",name:"description",placeholder:"Розкажіть коротко про ваш бізнес...",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>m(!1),className:"flex-1",children:"Скасувати"}),e.jsx(p,{type:"submit",disabled:s.isPending,className:"flex-1",children:s.isPending?"Надсилання...":"Надіслати заявку"})]})]})]})]})]})}function Me(){const{id:c}=D(),{user:m}=T(),j=B(),d=(m==null?void 0:m.id)===c,{isAdmin:n}=I(),{data:a}=g({queryKey:["profile",c],queryFn:async()=>{const{data:s,error:t}=await x.from("profiles").select("*").eq("id",c).single();if(t)throw t;return s}}),{data:i}=g({queryKey:["user-listings",c],queryFn:async()=>{const{data:s,error:t}=await x.from("listings").select("*").eq("user_id",c).eq("status","active").order("created_at",{ascending:!1});if(t)throw t;return s}}),{data:l}=g({queryKey:["user-favorites",c],queryFn:async()=>{if(!d)return[];const{data:s,error:t}=await x.from("favorites").select(`
          *,
          listings (
            id,
            title,
            price,
            currency,
            location,
            images,
            is_promoted,
            created_at
          )
        `).eq("user_id",c);if(t)throw t;return s},enabled:d});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(K,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"bg-card rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-muted flex items-center justify-center flex-shrink-0",children:a!=null&&a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:"",className:"w-full h-full rounded-full object-cover"}):e.jsx(ae,{className:"w-12 h-12 text-muted-foreground"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:(a==null?void 0:a.full_name)||(a==null?void 0:a.username)||"Користувач"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[(a==null?void 0:a.location)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-4 h-4"}),a.location]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"}),"На Novado з ",(a==null?void 0:a.created_at)&&new Date(a.created_at).getFullYear()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),(i==null?void 0:i.length)||0," оголошень"]})]})]}),d&&e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsxs(p,{variant:"default",size:"sm",onClick:()=>j("/admin"),className:"bg-gradient-to-r from-primary to-primary-dark",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Адмін панель"]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>j("/edit-profile"),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Редагувати"]})]})]})})]}),d&&e.jsx("div",{className:"mt-6",children:e.jsx(ne,{})})]}),e.jsxs(H,{defaultValue:"listings",className:"space-y-6",children:[e.jsxs(E,{className:"w-full justify-start",children:[e.jsxs(C,{value:"listings",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Оголошення (",(i==null?void 0:i.length)||0,")"]}),d&&e.jsxs(C,{value:"favorites",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Обране (",(l==null?void 0:l.length)||0,")"]})]}),e.jsx(S,{value:"listings",children:i&&i.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:i.map(s=>{var t;return e.jsx(q,{id:s.id,title:s.title,price:s.price||0,currency:s.currency,location:s.location,image:((t=s.images)==null?void 0:t[0])||"/placeholder.svg",isPromoted:s.is_promoted,createdAt:s.created_at},s.id)})}):e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg",children:[e.jsx(N,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:d?"У вас ще немає оголошень":"Користувач ще не має оголошень"})]})}),d&&e.jsx(S,{value:"favorites",children:l&&l.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:l.map(s=>{var t;return s.listings&&e.jsx(q,{id:s.listings.id,title:s.listings.title,price:s.listings.price||0,currency:s.listings.currency,location:s.listings.location,image:((t=s.listings.images)==null?void 0:t[0])||"/placeholder.svg",isPromoted:s.listings.is_promoted,createdAt:s.listings.created_at},s.listings.id)})}):e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg",children:[e.jsx(F,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"У вас ще немає обраних оголошень"})]})})]})]}),e.jsx(A,{})]})}export{Me as default};
