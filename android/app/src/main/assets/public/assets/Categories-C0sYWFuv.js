import{u as q,r as i,s as j,t as n,j as e,B as h,k as _,p as w}from"./index-KbJkRX07.js";import{u as y}from"./useAdmin-wN6CKAL8.js";import{A as z,a as P}from"./AdminHeader-BFn_Zmrn.js";import{I as t}from"./input-BfmWFPkP.js";import{T as R,a as V,b as k,c as d,d as O,e as o}from"./table--IrP7ivg.js";import{B as p}from"./badge-DpjjU75J.js";import{D as $,a as G,b as J,c as K,d as M}from"./dialog-C3rICmIe.js";import{L as c}from"./label-CwWGJCIM.js";import{S as Q,d as U,e as W,f as X,g as S}from"./select-CxSQralT.js";import{P as Y}from"./plus-D5zmitre.js";import{S as Z}from"./search-B1u6Ento.js";import{F as ee}from"./folder-tree-DKFA1oXY.js";import{E as se}from"./eye-jg7wg44x.js";import{S as re}from"./square-pen-q68WjATM.js";import{T as ae}from"./trash-2-CCvey3Fk.js";import"./Combination-CN-dILO0.js";import"./index-CAsdkEwS.js";import"./users-CUWo_zW8.js";import"./dollar-sign--DFDUvgJ.js";import"./settings-DWrH-Tg4.js";import"./index-D5jjwgwZ.js";function ke(){const g=q(),{isAdmin:f,loading:v}=y(),[N,T]=i.useState([]),[x,D]=i.useState(""),[E,F]=i.useState(!0),[L,u]=i.useState(!1),[l,b]=i.useState(null),[r,a]=i.useState({name:"",name_uk:"",slug:"",icon:"",color:"#0066cc",order_index:0,parent_id:""});i.useEffect(()=>{!v&&!f&&g("/")},[f,v,g]),i.useEffect(()=>{C()},[]);const C=async()=>{try{const{data:s,error:m}=await j.from("categories").select("*").order("order_index",{ascending:!0});if(m)throw m;T(s||[])}catch(s){console.error("Error loading categories:",s),n({title:"Помилка",description:"Не вдалося завантажити категорії",variant:"destructive"})}finally{F(!1)}},A=async()=>{if(!r.name||!r.name_uk||!r.slug){n({title:"Помилка",description:"Заповніть всі обов'язкові поля",variant:"destructive"});return}try{if(l){const{error:s}=await j.from("categories").update(r).eq("id",l.id);if(s)throw s;n({title:"Успішно",description:"Категорію оновлено"})}else{const{error:s}=await j.from("categories").insert([r]);if(s)throw s;n({title:"Успішно",description:"Категорію створено"})}u(!1),b(null),a({name:"",name_uk:"",slug:"",icon:"",color:"#0066cc",order_index:0,parent_id:""}),C()}catch{n({title:"Помилка",description:"Не вдалося зберегти категорію",variant:"destructive"})}},B=s=>{b(s),a({name:s.name,name_uk:s.name_uk,slug:s.slug,icon:s.icon||"",color:s.color||"#0066cc",order_index:s.order_index||0,parent_id:s.parent_id||""}),u(!0)},H=async s=>{if(confirm("Ви впевнені, що хочете видалити цю категорію?"))try{const{error:m}=await j.from("categories").delete().eq("id",s);if(m)throw m;n({title:"Успішно",description:"Категорію видалено"}),C()}catch{n({title:"Помилка",description:"Не вдалося видалити категорію",variant:"destructive"})}},I=N.filter(s=>s.name_uk.toLowerCase().includes(x.toLowerCase())||s.name.toLowerCase().includes(x.toLowerCase())||s.slug.toLowerCase().includes(x.toLowerCase()));return v||E?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):f?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(P,{})}),e.jsxs("main",{className:"flex-1 p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-primary-dark bg-clip-text text-transparent",children:"Управління категоріями"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Всього категорій: ",N.length]})]}),e.jsxs($,{open:L,onOpenChange:u,children:[e.jsx(G,{asChild:!0,children:e.jsxs(h,{className:"bg-gradient-to-r from-primary to-primary-dark hover:shadow-glow",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Додати категорію"]})}),e.jsxs(J,{className:"sm:max-w-md",children:[e.jsx(K,{children:e.jsx(M,{children:l?"Редагувати категорію":"Нова категорія"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name",children:"Назва (англ.)"}),e.jsx(t,{id:"name",value:r.name,onChange:s=>a({...r,name:s.target.value}),placeholder:"Electronics"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name_uk",children:"Назва (укр.)"}),e.jsx(t,{id:"name_uk",value:r.name_uk,onChange:s=>a({...r,name_uk:s.target.value}),placeholder:"Електроніка"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"slug",children:"Slug"}),e.jsx(t,{id:"slug",value:r.slug,onChange:s=>a({...r,slug:s.target.value}),placeholder:"electronics"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"icon",children:"Іконка"}),e.jsx(t,{id:"icon",value:r.icon,onChange:s=>a({...r,icon:s.target.value}),placeholder:"Smartphone"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"color",children:"Колір"}),e.jsx(t,{id:"color",type:"color",value:r.color,onChange:s=>a({...r,color:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"order_index",children:"Порядок"}),e.jsx(t,{id:"order_index",type:"number",value:r.order_index,onChange:s=>a({...r,order_index:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"parent_id",children:"Батьківська категорія"}),e.jsxs(Q,{value:r.parent_id,onValueChange:s=>a({...r,parent_id:s}),children:[e.jsx(U,{children:e.jsx(W,{placeholder:"Вибрати..."})}),e.jsxs(X,{children:[e.jsx(S,{value:"",children:"Без батьківської"}),N.filter(s=>s.id!==(l==null?void 0:l.id)).map(s=>e.jsx(S,{value:s.id,children:s.name_uk},s.id))]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(h,{onClick:A,className:"flex-1",children:l?"Оновити":"Створити"}),e.jsx(h,{variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"Скасувати"})]})]})]})]})]}),e.jsx(_,{className:"mb-6",children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(t,{placeholder:"Пошук категорій...",value:x,onChange:s=>D(s.target.value),className:"pl-10"})]})})}),e.jsx(_,{children:e.jsx(w,{className:"p-0",children:e.jsxs(R,{children:[e.jsx(V,{children:e.jsxs(k,{children:[e.jsx(d,{children:"Категорія"}),e.jsx(d,{children:"Slug"}),e.jsx(d,{children:"Іконка"}),e.jsx(d,{children:"Колір"}),e.jsx(d,{children:"Порядок"}),e.jsx(d,{children:"Батьківська"}),e.jsx(d,{className:"text-right",children:"Дії"})]})}),e.jsx(O,{children:I.map(s=>e.jsxs(k,{children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name_uk}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.name})]})}),e.jsx(o,{children:e.jsx(p,{variant:"outline",children:s.slug})}),e.jsx(o,{children:s.icon||"—"}),e.jsx(o,{children:s.color&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:s.color}}),e.jsx("span",{className:"text-sm",children:s.color})]})}),e.jsx(o,{children:e.jsx(p,{variant:"secondary",children:s.order_index})}),e.jsx(o,{children:s.parent_id?e.jsxs(p,{variant:"outline",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Підкатегорія"]}):e.jsx(p,{children:"Основна"})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(h,{variant:"outline",size:"icon",onClick:()=>g(`/category/${s.slug}`),children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx(h,{variant:"outline",size:"icon",onClick:()=>B(s),children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx(h,{variant:"destructive",size:"icon",onClick:()=>H(s.id),children:e.jsx(ae,{className:"w-4 h-4"})})]})})]},s.id))})]})})})]})]})]}):null}export{ke as default};
